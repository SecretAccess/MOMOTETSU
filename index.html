<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¡ƒé‰„GP 2024 ãƒã‚¹ã‚¿ãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
<style>
/* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
:root {
  --primary-color: #e74c3c; /* æ¡ƒé‰„ãƒ†ãƒ¼ãƒã«åˆã‚ã›ãŸèµ¤è‰² */
  --secondary-color: #3498db; /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
  --background-color: #f7f9fc;
  --card-bg: #ffffff;
  --text-color: #333333;
  --border-color: #e0e0e0;
  --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  --button-bg: #f1f1f1;
  --button-active: #d8d8d8;
  
  /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ©ãƒ¼ */
  --player1-color: #e74c3c;
  --player2-color: #3498db;
  --player3-color: #2ecc71;
  --player4-color: #9b59b6;
  
  /* ã‚«ãƒ¼ãƒ‰ã®è‰² */
  --card-front: #f39c12;
  --card-back: #2ecc71;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
  background-color: var(--background-color);
  color: var(--text-color);
  line-height: 1.6;
  padding-bottom: 60px;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
header {
  background-color: var(--primary-color);
  color: white;
  padding: 1rem;
  text-align: center;
  box-shadow: var(--shadow);
  position: relative;
}

header h1 {
  margin-bottom: 0.5rem;
  font-size: 1.8rem;
}

nav {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  padding: 0.5rem 0;
}

nav a {
  color: white;
  text-decoration: none;
  padding: 5px 10px;
  border-radius: 4px;
  transition: background-color 0.3s;
}

nav a:hover {
  background-color: rgba(255, 255, 255, 0.2);
}

/* ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
.dashboard-container {
  display: grid;
  grid-template-columns: 3fr 1fr;
  gap: 20px;
  max-width: 1600px;
  margin: 0 auto;
  padding: 20px;
}

/* å·¦å´ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ãªã©ï¼‰ */
.main-content {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒªãƒƒãƒ‰ */
.players-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ */
.player-card {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s, box-shadow 0.3s;
  position: relative;
  overflow: hidden;
}

.player-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.player-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.player-card h2 {
  color: white;
  text-align: center;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 1.5rem;
  margin: 0;
}

.player-card:nth-child(1) h2 {
  background-color: var(--player1-color);
}

.player-card:nth-child(2) h2 {
  background-color: var(--player2-color);
}

.player-card:nth-child(3) h2 {
  background-color: var(--player3-color);
}

.player-card:nth-child(4) h2 {
  background-color: var(--player4-color);
}

.player-stats {
  display: flex;
  gap: 10px;
}

.stat-badge {
  background-color: #f8f8f8;
  padding: 5px 8px;
  border-radius: 15px;
  font-size: 0.8rem;
  font-weight: bold;
}

.transfers-received {
  background-color: rgba(52, 152, 219, 0.2);
}

.forfeit-amount {
  background-color: rgba(231, 76, 60, 0.2);
}

.player-total {
  text-align: center;
  background: linear-gradient(to right, #f6f6f6, #f0f0f0);
  padding: 15px;
  border-radius: 8px;
  margin: 20px 0;
}

.total-label {
  font-size: 0.9rem;
  color: #777;
}

.total-value {
  font-size: 2.5rem;
  font-weight: bold;
}

.player-actions {
  display: flex;
  justify-content: space-around;
  margin-top: 15px;
}

.action-btn {
  padding: 10px 16px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 5px;
}

.action-btn:hover {
  transform: translateY(-2px);
}

.transfer-btn {
  background-color: rgba(52, 152, 219, 0.2);
  color: #2980b9;
}

.transfer-btn:hover {
  background-color: rgba(52, 152, 219, 0.3);
}

.forfeit-btn {
  background-color: rgba(231, 76, 60, 0.2);
  color: #c0392b;
}

.forfeit-btn:hover {
  background-color: rgba(231, 76, 60, 0.3);
}

/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ« */
.action-panel {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: var(--shadow);
}

.panel-title {
  color: var(--primary-color);
  margin-bottom: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.panel-title h3 {
  font-size: 1.3rem;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 30px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 22px;
  width: 22px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background-color: var(--primary-color);
}

input:focus + .toggle-slider {
  box-shadow: 0 0 1px var(--primary-color);
}

input:checked + .toggle-slider:before {
  transform: translateX(30px);
}

.toggle-label {
  margin-right: 10px;
  font-size: 0.9rem;
  font-weight: bold;
}

.transfer-form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.form-group {
  display: flex;
  gap: 10px;
  align-items: center;
}

.form-group label {
  min-width: 80px;
  font-weight: bold;
}

.form-control {
  padding: 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  flex-grow: 1;
}

input.form-control {
  width: 100px;
}

.form-control:focus {
  outline: none;
  border-color: var(--secondary-color);
  box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

.submit-btn {
  background-color: var(--secondary-color);
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  align-self: flex-end;
  transition: background-color 0.2s;
}

.submit-btn:hover {
  background-color: #2980b9;
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
.player-popup {
  display: none;
  position: absolute;
  width: 250px;
  background-color: white;
  border-radius: 10px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
  z-index: 100;
  animation: fadeIn 0.2s;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.popup-title {
  padding: 10px 15px;
  background-color: var(--secondary-color);
  color: white;
  border-radius: 10px 10px 0 0;
  font-weight: bold;
}

.popup-content {
  padding: 15px;
}

.player-option {
  padding: 8px 12px;
  margin-bottom: 5px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.player-option:hover {
  background-color: #f0f0f0;
}

.player-indicator {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
}

.player1-color {
  background-color: var(--player1-color);
}

.player2-color {
  background-color: var(--player2-color);
}

.player3-color {
  background-color: var(--player3-color);
}

.player4-color {
  background-color: var(--player4-color);
}

/* å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.history-section {
  margin-top: 20px;
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid var(--border-color);
  border-radius: 5px;
}

.history-item {
  padding: 8px 12px;
  border-bottom: 1px solid var(--border-color);
  font-size: 0.9rem;
}

.history-item:last-child {
  border-bottom: none;
}

.history-item.transfer {
  background-color: rgba(52, 152, 219, 0.1);
}

.history-item.forfeit {
  background-color: rgba(231, 76, 60, 0.1);
}

.no-history {
  padding: 20px;
  text-align: center;
  color: #777;
}

/* å³å´ã®ã‚µã‚¤ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.side-content {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ */
.summary-card {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: var(--shadow);
}

.summary-title {
  color: var(--primary-color);
  margin-bottom: 15px;
  font-size: 1.2rem;
  text-align: center;
}

.total-forfeit {
  background: linear-gradient(135deg, var(--primary-color) 0%, #c0392b 100%);
  color: white;
  padding: 15px;
  border-radius: 8px;
  text-align: center;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
}

.total-forfeit::before {
  content: "ğŸ’°";
  position: absolute;
  font-size: 5rem;
  opacity: 0.1;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.forfeit-label {
  font-size: 0.9rem;
}

.forfeit-value {
  font-size: 2rem;
  font-weight: bold;
  margin: 5px 0;
}

.rankings {
  list-style: none;
}

.ranking-item {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid #f0f0f0;
}

.ranking-item:last-child {
  border-bottom: none;
}

.player-name {
  display: flex;
  align-items: center;
  gap: 8px;
}

.ranking-value {
  font-weight: bold;
}

/* ã‚«ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
.active-rules {
  margin-bottom: 20px;
  max-height: 300px;
  overflow-y: auto;
}

.rules-list {
  list-style: none;
}

.rule-item {
  background-color: #f8f8f8;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 10px;
}

.rule-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 5px;
}

.rule-name {
  font-weight: bold;
  color: var(--primary-color);
}

.rule-action {
  color: #777;
  font-size: 0.8rem;
  cursor: pointer;
  background: none;
  border: none;
  padding: 3px 8px;
  border-radius: 3px;
}

.rule-action:hover {
  color: var(--primary-color);
  background-color: rgba(231, 76, 60, 0.1);
}

.rule-description {
  font-size: 0.9rem;
  color: #666;
  line-height: 1.4;
}

.no-rules {
  padding: 15px;
  text-align: center;
  color: #777;
  background-color: #f8f8f8;
  border-radius: 5px;
}

/* ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒƒã‚­ */
.card-deck {
  perspective: 1000px;
  height: 280px;
  position: relative;
  cursor: pointer;
}

.deck-label {
  text-align: center;
  margin-bottom: 10px;
  color: #777;
  font-size: 0.9rem;
}

.card {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.8s;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  border-radius: 10px;
}

.card-front {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--card-front);
  background: linear-gradient(135deg, var(--card-front) 0%, #e67e22 100%);
  color: white;
  font-size: 1.8rem;
  font-weight: bold;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.card-front:before {
  content: "?";
  font-size: 5rem;
  opacity: 0.2;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.card-front:after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: repeating-linear-gradient(
    45deg,
    rgba(255, 255, 255, 0.1),
    rgba(255, 255, 255, 0.1) 10px,
    rgba(255, 255, 255, 0.2) 10px,
    rgba(255, 255, 255, 0.2) 20px
  );
  border-radius: 10px;
}

.cards-remaining {
  position: absolute;
  bottom: 10px;
  right: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  color: white;
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 0.8rem;
  z-index: 2;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
.modal-container {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal {
  background-color: white;
  border-radius: 10px;
  padding: 20px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  position: relative;
  animation: modalFadeIn 0.3s;
}

@keyframes modalFadeIn {
  from { opacity: 0; transform: translateY(-50px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.modal-title {
  font-size: 1.5rem;
  color: var(--primary-color);
}

.close-modal {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #aaa;
}

.close-modal:hover {
  color: var(--primary-color);
}

.modal-body {
  margin-bottom: 20px;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.modal-btn {
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}

.cancel-btn {
  background-color: #f1f1f1;
  color: #333;
}

.confirm-btn {
  background-color: var(--secondary-color);
  color: white;
}

/* ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« */
.card-reveal {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.revealed-card {
  background: var(--card-back);
  background: linear-gradient(135deg, var(--card-back) 0%, #27ae60 100%);
  color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  width: 100%;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.card-title {
  font-size: 1.5rem;
  margin-bottom: 15px;
  position: relative;
  display: inline-block;
}

.card-title:after {
  content: "";
  display: block;
  width: 60%;
  height: 2px;
  background-color: rgba(255, 255, 255, 0.5);
  position: absolute;
  bottom: -5px;
  left: 20%;
}

.card-description {
  font-size: 1.1rem;
  line-height: 1.5;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

/* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
.toast-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
}

.toast {
  background-color: white;
  color: var(--text-color);
  padding: 12px 20px;
  border-radius: 5px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 300px;
  animation: toastFadeIn 0.3s, toastFadeOut 0.3s 2.7s;
  animation-fill-mode: forwards;
  opacity: 0;
}

@keyframes toastFadeIn {
  from { opacity: 0; transform: translateX(50px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes toastFadeOut {
  from { opacity: 1; transform: translateX(0); }
  to { opacity: 0; transform: translateX(50px); }
}

.toast-icon {
  font-size: 1.5rem;
}

.toast-success {
  border-left: 4px solid #2ecc71;
}

.toast-warning {
  border-left: 4px solid #f39c12;
}

.toast-error {
  border-left: 4px solid #e74c3c;
}

.toast-content {
  flex-grow: 1;
}

.toast-title {
  font-weight: bold;
  margin-bottom: 3px;
}

.toast-message {
  font-size: 0.9rem;
}

/* ãƒã‚¤ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« */
.point-input-modal {
  display: none;
  position: fixed;
  z-index: 100;
  background-color: white;
  border-radius: 10px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
  width: 90%;
  max-width: 300px;
  padding: 15px;
  animation: fadeIn 0.2s;
}

.point-input-header {
  margin-bottom: 15px;
  color: var(--primary-color);
  font-weight: bold;
  font-size: 1.1rem;
}

.point-input-content {
  margin-bottom: 15px;
}

.point-input-field {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  margin-bottom: 10px;
}

.point-input-field:focus {
  outline: none;
  border-color: var(--secondary-color);
  box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

.point-input-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.point-input-btn {
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}

.point-cancel-btn {
  background-color: #f1f1f1;
  color: #333;
}

.point-confirm-btn {
  background-color: var(--secondary-color);
  color: white;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 1200px) {
  .dashboard-container {
    grid-template-columns: 1fr;
  }
  
  .players-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .players-grid {
    grid-template-columns: 1fr;
  }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.pulse {
  animation: pulse-animation 0.5s;
}

@keyframes pulse-animation {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.shake {
  animation: shake-animation 0.5s;
}

@keyframes shake-animation {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
  20%, 40%, 60%, 80% { transform: translateX(5px); }
}

.float {
  animation: float-animation 3s infinite ease-in-out;
}

@keyframes float-animation {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}
</style>
</head>
<body>
<header>
  <h1>æ¡ƒé‰„GP ãƒã‚¹ã‚¿ãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
  <nav>
    <a href="index.html">ãƒãƒƒãƒ—ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</a>
    <a href="rules.html">å¤§ä¼šãƒ«ãƒ¼ãƒ«</a>
    <a href="cards.html">ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰</a>
    <a href="roulette.html">æŠ½é¸ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</a>
    <a href="forfeit-counter.html">æ²¡åãƒã‚¤ãƒ³ãƒˆ</a>
    <a href="hidden-destination.html">è£ç›®çš„åœ°</a>
  </nav>
</header>

<div class="dashboard-container">
  <!-- å·¦å´ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="main-content">
    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒªãƒƒãƒ‰ -->
    <div class="players-grid">
      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1 -->
      <div class="player-card" data-player="nozomu">
        <div class="player-header">
          <h2>ã®ãã‚€</h2>
          <div class="player-stats">
            <span class="stat-badge transfers-received" title="å—å–ãƒã‚¤ãƒ³ãƒˆç´¯è¨ˆ">0 Pt</span>
            <span class="stat-badge forfeit-amount" title="æ²¡åãƒã‚¤ãƒ³ãƒˆç´¯è¨ˆ">0 Pt</span>
          </div>
        </div>
        <div class="player-total">
          <div class="total-label">ç·è³‡ç”£</div>
          <div class="total-value" data-total>15,000 Pt</div>
        </div>
        <div class="player-actions">
          <button class="action-btn transfer-btn" data-action="transfer">
            <span>ç§»å‹•</span>
          </button>
          <button class="action-btn forfeit-btn" data-action="forfeit">
            <span>æ²¡å</span>
          </button>
        </div>
      </div>
      
      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2 -->
      <div class="player-card" data-player="madoka">
        <div class="player-header">
          <h2>ã¾ã©ã‹</h2>
          <div class="player-stats">
            <span class="stat-badge transfers-received" title="å—å–ãƒã‚¤ãƒ³ãƒˆç´¯è¨ˆ">0 Pt</span>
            <span class="stat-badge forfeit-amount" title="æ²¡åãƒã‚¤ãƒ³ãƒˆç´¯è¨ˆ">0 Pt</span>
          </div>
        </div>
        <div class="player-total">
          <div class="total-label">ç·è³‡ç”£</div>
          <div class="total-value" data-total>15,000 Pt</div>
        </div>
        <div class="player-actions">
          <button class="action-btn transfer-btn" data-action="transfer">
            <span>ç§»å‹•</span>
          </button>
          <button class="action-btn forfeit-btn" data-action="forfeit">
            <span>æ²¡å</span>
          </button>
        </div>
      </div>
      
      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼3 -->
      <div class="player-card" data-player="hikaru">
        <div class="player-header">
          <h2>ã²ã‹ã‚‹</h2>
          <div class="player-stats">
            <span class="stat-badge transfers-received" title="å—å–ãƒã‚¤ãƒ³ãƒˆç´¯è¨ˆ">0 Pt</span>
            <span class="stat-badge forfeit-amount" title="æ²¡åãƒã‚¤ãƒ³ãƒˆç´¯è¨ˆ">0 Pt</span>
          </div>
        </div>
        <div class="player-total">
          <div class="total-label">ç·è³‡ç”£</div>
          <div class="total-value" data-total>15,000 Pt</div>
        </div>
        <div class="player-actions">
          <button class="action-btn transfer-btn" data-action="transfer">
            <span>ç§»å‹•</span>
          </button>
          <button class="action-btn forfeit-btn" data-action="forfeit">
            <span>æ²¡å</span>
          </button>
        </div>
      </div>
      
      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼4 -->
      <div class="player-card" data-player="chie">
        <div class="player-header">
          <h2>ã¡ãˆ</h2>
          <div class="player-stats">
            <span class="stat-badge transfers-received" title="å—å–ãƒã‚¤ãƒ³ãƒˆç´¯è¨ˆ">0 Pt</span>
            <span class="stat-badge forfeit-amount" title="æ²¡åãƒã‚¤ãƒ³ãƒˆç´¯è¨ˆ">0 Pt</span>
          </div>
        </div>
        <div class="player-total">
          <div class="total-label">ç·è³‡ç”£</div>
          <div class="total-value" data-total>15,000 Pt</div>
        </div>
        <div class="player-actions">
          <button class="action-btn transfer-btn" data-action="transfer">
            <span>ç§»å‹•</span>
          </button>
          <button class="action-btn forfeit-btn" data-action="forfeit">
            <span>æ²¡å</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ« -->
    <div class="action-panel">
      <div class="panel-title">
        <h3>æ“ä½œå±¥æ­´</h3>
        <div style="display: flex; align-items: center;">
          <span class="toggle-label">å€ãƒ¢ãƒ¼ãƒ‰</span>
          <label class="toggle-switch">
            <input type="checkbox" id="double-mode-toggle">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      <div class="history-section">
        <div class="no-history">ã¾ã å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>
      </div>
    </div>
  </div>
  
  <!-- å³å´ã®ã‚µã‚¤ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="side-content">
    <!-- ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ -->
    <div class="summary-card">
      <h3 class="summary-title">çµ±è¨ˆ</h3>
      <div class="total-forfeit">
        <div class="forfeit-label">æ²¡åãƒã‚¤ãƒ³ãƒˆåˆè¨ˆ</div>
        <div class="forfeit-value" id="total-forfeit">0 Pt</div>
      </div>
      <h4 style="margin-bottom: 10px;">å—å–ãƒã‚¤ãƒ³ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°</h4>
      <ul class="rankings" id="transfer-ranking">
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player1-color"></span>
            <span>ã®ãã‚€</span>
          </div>
          <div class="ranking-value">0 Pt</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player2-color"></span>
            <span>ã¾ã©ã‹</span>
          </div>
          <div class="ranking-value">0 Pt</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player3-color"></span>
            <span>ã²ã‹ã‚‹</span>
          </div>
          <div class="ranking-value">0 Pt</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player4-color"></span>
            <span>ã¡ãˆ</span>
          </div>
          <div class="ranking-value">0 Pt</div>
        </li>
      </ul>
      
      <h4 style="margin: 15px 0 10px;">æ²¡åãƒã‚¤ãƒ³ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°</h4>
      <ul class="rankings" id="forfeit-ranking">
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player1-color"></span>
            <span>ã®ãã‚€</span>
          </div>
          <div class="ranking-value">0 Pt</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player2-color"></span>
            <span>ã¾ã©ã‹</span>
          </div>
          <div class="ranking-value">0 Pt</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player3-color"></span>
            <span>ã²ã‹ã‚‹</span>
          </div>
          <div class="ranking-value">0 Pt</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player4-color"></span>
            <span>ã¡ãˆ</span>
          </div>
          <div class="ranking-value">0 Pt</div>
        </li>
      </ul>
    </div>
    
    <!-- ã‚«ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
    <div class="summary-card">
      <h3 class="summary-title">é©ç”¨ä¸­ã®ãƒ«ãƒ¼ãƒ«</h3>
      <div class="active-rules">
        <div class="no-rules" id="no-rules-message">ç¾åœ¨é©ç”¨ä¸­ã®ãƒ«ãƒ¼ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“</div>
        <ul class="rules-list" id="rules-list"></ul>
      </div>
      <div class="deck-label">ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã</div>
      <div class="card-deck" id="card-deck">
        <div class="card">
          <div class="card-front"></div>
        </div>
        <div class="cards-remaining" id="cards-remaining">12æš</div>
      </div>
    </div>
  </div>
</div>

<!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
<div class="player-popup" id="player-popup">
  <div class="popup-title">ç§»å‹•å…ˆã‚’é¸æŠ</div>
  <div class="popup-content" id="popup-content">
    <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯JSã§å‹•çš„ã«è¿½åŠ  -->
  </div>
</div>

<!-- ãƒã‚¤ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆç§»å‹•ç”¨ï¼‰ -->
<div class="point-input-modal" id="transfer-point-modal">
  <div class="point-input-header">ãƒã‚¤ãƒ³ãƒˆç§»å‹•</div>
  <div class="point-input-content">
    <div id="transfer-message">ã®ãã‚€ ã‹ã‚‰ ã¾ã©ã‹ ã¸ç§»å‹•ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆ:</div>
    <input type="number" id="transfer-point-input" class="point-input-field" min="1" value="300">
  </div>
  <div class="point-input-buttons">
    <button class="point-input-btn point-cancel-btn" id="transfer-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    <button class="point-input-btn point-confirm-btn" id="transfer-confirm">å®Ÿè¡Œ</button>
  </div>
</div>

<!-- ãƒã‚¤ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ²¡åç”¨ï¼‰ -->
<div class="point-input-modal" id="forfeit-point-modal">
  <div class="point-input-header">ãƒã‚¤ãƒ³ãƒˆæ²¡å</div>
  <div class="point-input-content">
    <div id="forfeit-message">ã®ãã‚€ ã‹ã‚‰æ²¡åã™ã‚‹ãƒã‚¤ãƒ³ãƒˆ:</div>
    <input type="number" id="forfeit-point-input" class="point-input-field" min="1" value="300">
    <div id="forfeit-double-notice" style="display: none; color: #e74c3c; font-size: 0.9rem; margin-top: 5px;">
      â€»å€ãƒ¢ãƒ¼ãƒ‰é©ç”¨: <span id="forfeit-double-amount">600 Pt</span> ãŒæ²¡åã•ã‚Œã¾ã™
    </div>
  </div>
  <div class="point-input-buttons">
    <button class="point-input-btn point-cancel-btn" id="forfeit-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    <button class="point-input-btn point-confirm-btn" id="forfeit-confirm">å®Ÿè¡Œ</button>
  </div>
</div>

<!-- ç§»å‹•ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-container" id="transfer-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">ãƒã‚¤ãƒ³ãƒˆç§»å‹•ç¢ºèª</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body" id="transfer-modal-body">
      <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã§ãƒã‚¤ãƒ³ãƒˆã‚’ç§»å‹•ã—ã¾ã™ã€‚</p>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="modal-btn confirm-btn" id="confirm-transfer">å®Ÿè¡Œ</button>
    </div>
  </div>
</div>

<!-- æ²¡åç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-container" id="forfeit-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">ãƒã‚¤ãƒ³ãƒˆæ²¡åç¢ºèª</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body" id="forfeit-modal-body">
      <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ãƒã‚¤ãƒ³ãƒˆã‚’æ²¡åã—ã¾ã™ã€‚</p>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="modal-btn confirm-btn" id="confirm-forfeit">å®Ÿè¡Œ</button>
    </div>
  </div>
</div>

<!-- ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-container" id="card-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="card-reveal">
        <div class="revealed-card">
          <div class="card-title" id="card-title">ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«</div>
          <div class="card-description" id="card-description">ã‚«ãƒ¼ãƒ‰ã®åŠ¹æœèª¬æ˜ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel-btn" id="discard-card">ç ´æ£„</button>
      <button class="modal-btn confirm-btn" id="apply-card">é©ç”¨</button>
    </div>
  </div>
</div>

<!-- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ -->
<div class="toast-container" id="toast-container"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿
  const players = {
    nozomu: {
      name: "ã®ãã‚€",
      points: 15000,
      receivedPoints: 0,
      forfeitedPoints: 0
    },
    madoka: {
      name: "ã¾ã©ã‹",
      points: 15000,
      receivedPoints: 0,
      forfeitedPoints: 0
    },
    hikaru: {
      name: "ã²ã‹ã‚‹",
      points: 15000,
      receivedPoints: 0,
      forfeitedPoints: 0
    },
    chie: {
      name: "ã¡ãˆ",
      points: 15000,
      receivedPoints: 0,
      forfeitedPoints: 0
    }
  };
  
  // æ²¡åãƒã‚¤ãƒ³ãƒˆåˆè¨ˆ
  let totalForfeit = 0;
  
  // å€ãƒ¢ãƒ¼ãƒ‰ãƒ•ãƒ©ã‚°
  let doubleMode = false;
  
  // ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
  const cards = [
    { title: "é‹å‘½ã®æ“ä½œ", rule: "æŒ‡å®šã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã®é€²è·¯ã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚" },
    { title: "å¤©ç½", rule: "å…¨å“¡ã‹ã‚‰é»’ãƒãƒƒãƒ—1æšã‚’æ²¡åã€‚" },
    { title: "é˜»å®³è¨ˆç”»", rule: "æ¬¡ã®ç›®çš„åœ°åˆ°é”ãƒœãƒ¼ãƒŠã‚¹ã‚’ç„¡åŠ¹åŒ–ã€‚" },
    { title: "é©å‘½ã®ç¯", rule: "1ä½ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨è‡ªèº«ã®ãƒãƒƒãƒ—ã‚’äº¤æ›ã™ã‚‹ã€‚" },
    { title: "çµŒæ¸ˆæˆé•·æœŸ", rule: "æ¬¡å›ã®ç›®çš„åœ°åˆ°é”ãƒœãƒ¼ãƒŠã‚¹ãŒ2å€ã€‚" },
    { title: "çµŒæ¸ˆä¸æ³", rule: "ä»Šå›ã®ç›®çš„åœ°åˆ°é”ãƒœãƒ¼ãƒŠã‚¹æ²¡åã€‚" },
    { title: "å½å–„ã®å¿ƒ", rule: "å…¨å“¡ãŒç™½ãƒãƒƒãƒ—1æšã‚’ã€æœ€ã‚‚å°‘ãªã„ãƒãƒƒãƒ—ã‚’æŒã¤ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å…¨ã¦è´ˆä¸ã€‚" },
    { title: "å¼·å¥ª", rule: "æŒ‡å®šã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰é»’ãƒãƒƒãƒ—1æšã‚’ç²å¾—ã€‚" },
    { title: "å¤§å¯Œè±ªã®æ©æµ", rule: "å…¨å“¡ã‹ã‚‰é»’ãƒãƒƒãƒ—1æšãšã¤ã‚’ç²å¾—ã€‚" },
    { title: "ç ´ç”£å®£å‘Š", rule: "æŒ‡å®šã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¨ã¦ã®é»’ãƒãƒƒãƒ—ã‚’æ²¡åã€‚" },
    { title: "å¾©è®ã®ä¸€æ’ƒ", rule: "æŒ‡å®šã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰é»’ãƒãƒƒãƒ—2æšã‚’ç²å¾—ã€‚" },
    { title: "ç„¡æ•µã®é˜²å¾¡", rule: "ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚«ãƒ¼ãƒ‰åŠ¹æœã‚’å—ã‘ãªããªã‚‹ã€‚" }
  ];
  
  // ã‚«ãƒ¼ãƒ‰ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  let shuffledCards = [...cards].sort(() => Math.random() - 0.5);
  let activeRules = [];
  
  // å±¥æ­´ãƒ‡ãƒ¼ã‚¿
  let history = [];
  
  // é¸æŠä¸­ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±
  let selectedFromPlayer = null;
  let selectedToPlayer = null;
  let selectedPoints = 0;
  
  // DOMè¦ç´ ã®å‚ç…§ã‚’å–å¾—
  const doubleModeToggle = document.getElementById('double-mode-toggle');
  const historySection = document.querySelector('.history-section');
  const transferModal = document.getElementById('transfer-modal');
  const forfeitModal = document.getElementById('forfeit-modal');
  const transferModalBody = document.getElementById('transfer-modal-body');
  const forfeitModalBody = document.getElementById('forfeit-modal-body');
  const confirmTransferBtn = document.getElementById('confirm-transfer');
  const confirmForfeitBtn = document.getElementById('confirm-forfeit');
  const totalForfeitDisplay = document.getElementById('total-forfeit');
  const transferRanking = document.getElementById('transfer-ranking');
  const forfeitRanking = document.getElementById('forfeit-ranking');
  const cardDeck = document.getElementById('card-deck');
  const cardsRemaining = document.getElementById('cards-remaining');
  const cardModal = document.getElementById('card-modal');
  const cardTitle = document.getElementById('card-title');
  const cardDescription = document.getElementById('card-description');
  const applyCardBtn = document.getElementById('apply-card');
  const discardCardBtn = document.getElementById('discard-card');
  const rulesList = document.getElementById('rules-list');
  const noRulesMessage = document.getElementById('no-rules-message');
  const toastContainer = document.getElementById('toast-container');
  const playerPopup = document.getElementById('player-popup');
  const popupContent = document.getElementById('popup-content');
  const transferPointModal = document.getElementById('transfer-point-modal');
  const forfeitPointModal = document.getElementById('forfeit-point-modal');
  const transferMessage = document.getElementById('transfer-message');
  const forfeitMessage = document.getElementById('forfeit-message');
  const transferPointInput = document.getElementById('transfer-point-input');
  const forfeitPointInput = document.getElementById('forfeit-point-input');
  const transferCancel = document.getElementById('transfer-cancel');
  const transferConfirm = document.getElementById('transfer-confirm');
  const forfeitCancel = document.getElementById('forfeit-cancel');
  const forfeitConfirm = document.getElementById('forfeit-confirm');
  const forfeitDoubleNotice = document.getElementById('forfeit-double-notice');
  const forfeitDoubleAmount = document.getElementById('forfeit-double-amount');
  
  // ç¾åœ¨é¸æŠä¸­ã®ã‚«ãƒ¼ãƒ‰
  let currentCard = null;
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  document.querySelectorAll('.close-modal, .cancel-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.modal-container').forEach(modal => {
        modal.style.display = 'none';
      });
    });
  });
  
  // ãƒã‚¤ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³
  transferCancel.addEventListener('click', function() {
    transferPointModal.style.display = 'none';
  });
  
  forfeitCancel.addEventListener('click', function() {
    forfeitPointModal.style.display = 'none';
  });
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç·è³‡ç”£ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updatePlayerDisplay(playerId) {
    const player = players[playerId];
    const playerCard = document.querySelector(`.player-card[data-player="${playerId}"]`);
    
    if (playerCard) {
      // ç·è³‡ç”£ã‚’æ›´æ–°
      const totalElement = playerCard.querySelector('[data-total]');
      if (totalElement) {
        totalElement.textContent = `${player.points.toLocaleString()} Pt`;
      }
      
      // å—å–/æ²¡åãƒã‚¤ãƒ³ãƒˆçµ±è¨ˆã‚’æ›´æ–°
      const receivedPointsElement = playerCard.querySelector('.transfers-received');
      const forfeitedPointsElement = playerCard.querySelector('.forfeit-amount');
      
      if (receivedPointsElement) {
        receivedPointsElement.textContent = `${player.receivedPoints.toLocaleString()} Pt`;
      }
      
      if (forfeitedPointsElement) {
        forfeitedPointsElement.textContent = `${player.forfeitedPoints.toLocaleString()} Pt`;
      }
    }
  }
  
  // æ²¡åãƒã‚¤ãƒ³ãƒˆåˆè¨ˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateTotalForfeit() {
    totalForfeitDisplay.textContent = `${totalForfeit.toLocaleString()} Pt`;
  }
  
  // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateRankings() {
    // å—å–ãƒã‚¤ãƒ³ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°
    const transferEntries = Object.entries(players).map(([id, player]) => ({ id, points: player.receivedPoints }));
    transferEntries.sort((a, b) => b.points - a.points);
    
    const transferItems = transferRanking.querySelectorAll('.ranking-item');
    transferEntries.forEach((entry, index) => {
      const item = transferItems[index];
      if (item) {
        const playerName = item.querySelector('.player-name span:last-child');
        const rankingValue = item.querySelector('.ranking-value');
        
        if (playerName) {
          playerName.textContent = players[entry.id].name;
        }
        
        if (rankingValue) {
          rankingValue.textContent = `${entry.points.toLocaleString()} Pt`;
        }
      }
    });
    
    // æ²¡åãƒã‚¤ãƒ³ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°
    const forfeitEntries = Object.entries(players).map(([id, player]) => ({ id, points: player.forfeitedPoints }));
    forfeitEntries.sort((a, b) => b.points - a.points);
    
    const forfeitItems = forfeitRanking.querySelectorAll('.ranking-item');
    forfeitEntries.forEach((entry, index) => {
      const item = forfeitItems[index];
      if (item) {
        const playerName = item.querySelector('.player-name span:last-child');
        const rankingValue = item.querySelector('.ranking-value');
        
        if (playerName) {
          playerName.textContent = players[entry.id].name;
        }
        
        if (rankingValue) {
          rankingValue.textContent = `${entry.points.toLocaleString()} Pt`;
        }
      }
    });
  }
  
  // å±¥æ­´ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
  function addHistory(action, from, to, points) {
    const now = new Date();
    const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
    
    let message = '';
    if (action === 'transfer') {
      message = `${timeString} - ${players[from].name} â†’ ${players[to].name}: ${points.toLocaleString()} Pt`;
    } else if (action === 'forfeit') {
      message = `${timeString} - ${players[from].name} ã‹ã‚‰æ²¡å: ${points.toLocaleString()} Pt`;
    }
    
    const historyItem = document.createElement('div');
    historyItem.classList.add('history-item', action);
    historyItem.textContent = message;
    
    // ã€Œã¾ã å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
    const noHistory = historySection.querySelector('.no-history');
    if (noHistory) {
      noHistory.remove();
    }
    
    // å…ˆé ­ã«è¿½åŠ 
    if (historySection.firstChild) {
      historySection.insertBefore(historyItem, historySection.firstChild);
    } else {
      historySection.appendChild(historyItem);
    }
    
    // å±¥æ­´é…åˆ—ã«è¿½åŠ 
    history.unshift({
      action,
      from,
      to,
      points,
      timestamp: now.getTime()
    });
    
    // å±¥æ­´ã®æ•°ã‚’åˆ¶é™ï¼ˆæœ€æ–°20ä»¶ã®ã¿ï¼‰
    if (historySection.children.length > 20) {
      historySection.removeChild(historySection.lastChild);
    }
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    saveState();
  }
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã®ãƒã‚¤ãƒ³ãƒˆç§»å‹•ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
  function executeTransfer(fromPlayer, toPlayer, points) {
    // ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã®æ•°ã‹ç¢ºèª
    if (points <= 0) {
      showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'ãƒã‚¤ãƒ³ãƒˆã¯1ä»¥ä¸Šã®æ•´æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚');
      return false;
    }
    
    // ãƒã‚¤ãƒ³ãƒˆãŒååˆ†ã«ã‚ã‚‹ã‹ç¢ºèª
    if (players[fromPlayer].points < points) {
      showToast('error', 'ã‚¨ãƒ©ãƒ¼', `${players[fromPlayer].name}ã®ãƒã‚¤ãƒ³ãƒˆãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚`);
      return false;
    }
    
    // ãƒã‚¤ãƒ³ãƒˆã‚’ç§»å‹•
    players[fromPlayer].points -= points;
    players[toPlayer].points += points;
    
    // å—å–ãƒã‚¤ãƒ³ãƒˆã«è¿½åŠ 
    players[toPlayer].receivedPoints += points;
    
    // è¡¨ç¤ºã‚’æ›´æ–°
    updatePlayerDisplay(fromPlayer);
    updatePlayerDisplay(toPlayer);
    updateRankings();
    
    // å±¥æ­´ã«è¿½åŠ 
    addHistory('transfer', fromPlayer, toPlayer, points);
    
    // é€šçŸ¥
    showToast('success', 'ãƒã‚¤ãƒ³ãƒˆç§»å‹•', `${players[fromPlayer].name}ã‹ã‚‰${players[toPlayer].name}ã¸${points.toLocaleString()} Ptç§»å‹•ã—ã¾ã—ãŸã€‚`);
    
    return true;
  }
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ã®ãƒã‚¤ãƒ³ãƒˆæ²¡åã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
  function executeForfeit(fromPlayer, points) {
    // ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã®æ•°ã‹ç¢ºèª
    if (points <= 0) {
      showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'ãƒã‚¤ãƒ³ãƒˆã¯1ä»¥ä¸Šã®æ•´æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚');
      return false;
    }
    
    // å€ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ãƒã‚¤ãƒ³ãƒˆã‚’å€ã«ã™ã‚‹
    let actualPoints = points;
    if (doubleMode) {
      actualPoints *= 2;
    }
    
    // ãƒã‚¤ãƒ³ãƒˆãŒååˆ†ã«ã‚ã‚‹ã‹ç¢ºèª
    if (players[fromPlayer].points < actualPoints) {
      showToast('error', 'ã‚¨ãƒ©ãƒ¼', `${players[fromPlayer].name}ã®ãƒã‚¤ãƒ³ãƒˆãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚`);
      return false;
    }
    
    // ãƒã‚¤ãƒ³ãƒˆã‚’æ²¡å
    players[fromPlayer].points -= actualPoints;
    totalForfeit += actualPoints;
    
    // æ²¡åã•ã‚ŒãŸãƒã‚¤ãƒ³ãƒˆã«è¿½åŠ 
    players[fromPlayer].forfeitedPoints += actualPoints;
    
    // è¡¨ç¤ºã‚’æ›´æ–°
    updatePlayerDisplay(fromPlayer);
    updateTotalForfeit();
    updateRankings();
    
    // å±¥æ­´ã«è¿½åŠ 
    addHistory('forfeit', fromPlayer, 'forfeit', actualPoints);
    
    // é€šçŸ¥
    showToast('warning', 'ãƒã‚¤ãƒ³ãƒˆæ²¡å', `${players[fromPlayer].name}ã‹ã‚‰${actualPoints.toLocaleString()} Ptã‚’æ²¡åã—ã¾ã—ãŸã€‚`);
    
    return true;
  }
  
  // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function showToast(type, title, message) {
    const toast = document.createElement('div');
    toast.classList.add('toast', `toast-${type}`);
    
    let icon = '';
    switch (type) {
      case 'success':
        icon = 'âœ…';
        break;
      case 'warning':
        icon = 'âš ï¸';
        break;
      case 'error':
        icon = 'âŒ';
        break;
      default:
        icon = 'â„¹ï¸';
    }
    
    toast.innerHTML = `
      <div class="toast-icon">${icon}</div>
      <div class="toast-content">
        <div class="toast-title">${title}</div>
        <div class="toast-message">${message}</div>
      </div>
    `;
    
    toastContainer.appendChild(toast);
    
    // 3ç§’å¾Œã«å‰Šé™¤
    setTimeout(() => {
      toast.remove();
    }, 3000);
  }
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function showPlayerPopup(fromPlayerId, element) {
    const rect = element.getBoundingClientRect();
    
    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ä½ç½®ã‚’è¨­å®š
    playerPopup.style.position = 'absolute';
    playerPopup.style.top = `${rect.bottom + window.scrollY + 10}px`;
    playerPopup.style.left = `${rect.left + window.scrollX}px`;
    
    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¯ãƒªã‚¢
    popupContent.innerHTML = '';
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆé€ä¿¡å…ƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯é™¤ãï¼‰
    Object.keys(players).forEach(playerId => {
      if (playerId !== fromPlayerId) {
        const option = document.createElement('div');
        option.classList.add('player-option');
        
        let indicatorClass = '';
        if (playerId === 'nozomu') indicatorClass = 'player1-color';
        else if (playerId === 'madoka') indicatorClass = 'player2-color';
        else if (playerId === 'hikaru') indicatorClass = 'player3-color';
        else if (playerId === 'chie') indicatorClass = 'player4-color';
        
        option.innerHTML = `
          <span class="player-indicator ${indicatorClass}"></span>
          <span>${players[playerId].name}</span>
        `;
        
        option.addEventListener('click', function() {
          // é¸æŠã•ã‚ŒãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¨˜éŒ²
          selectedFromPlayer = fromPlayerId;
          selectedToPlayer = playerId;
          
          // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’éè¡¨ç¤º
          playerPopup.style.display = 'none';
          
          // ãƒã‚¤ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
          showTransferPointModal(fromPlayerId, playerId);
        });
        
        popupContent.appendChild(option);
      }
    });
    
    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
    playerPopup.style.display = 'block';
  }
  
  // ãƒã‚¤ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆç§»å‹•ç”¨ï¼‰ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function showTransferPointModal(fromPlayerId, toPlayerId) {
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°
    transferMessage.textContent = `${players[fromPlayerId].name} ã‹ã‚‰ ${players[toPlayerId].name} ã¸ç§»å‹•ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆ:`;
    
    // å…¥åŠ›æ¬„ã‚’ãƒªã‚»ãƒƒãƒˆ
    transferPointInput.value = '300';
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ä½ç½®ã‚’ä¸­å¤®ã«
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;
    const modalWidth = transferPointModal.offsetWidth || 300;
    const modalHeight = transferPointModal.offsetHeight || 200;
    
    transferPointModal.style.position = 'fixed';
    transferPointModal.style.top = `${(viewportHeight - modalHeight) / 2}px`;
    transferPointModal.style.left = `${(viewportWidth - modalWidth) / 2}px`;
    
    // ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    transferConfirm.onclick = function() {
      const points = parseInt(transferPointInput.value);
      if (isNaN(points) || points <= 0) {
        showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'ãƒã‚¤ãƒ³ãƒˆã¯1ä»¥ä¸Šã®æ•´æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚');
        return;
      }
      
      // ç§»å‹•ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      transferModalBody.innerHTML = `<p>${players[fromPlayerId].name}ã‹ã‚‰ ${players[toPlayerId].name} ã¸ ${points.toLocaleString()} Pt ã‚’ç§»å‹•ã—ã¾ã™ã€‚</p>`;
      transferModal.style.display = 'flex';
      transferPointModal.style.display = 'none';
      
      // ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      confirmTransferBtn.onclick = function() {
        if (executeTransfer(fromPlayerId, toPlayerId, points)) {
          transferModal.style.display = 'none';
        }
      };
    };
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    transferPointModal.style.display = 'block';
  }
  
  // ãƒã‚¤ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ²¡åç”¨ï¼‰ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function showForfeitPointModal(fromPlayerId) {
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°
    forfeitMessage.textContent = `${players[fromPlayerId].name} ã‹ã‚‰æ²¡åã™ã‚‹ãƒã‚¤ãƒ³ãƒˆ:`;
    
    // å…¥åŠ›æ¬„ã‚’ãƒªã‚»ãƒƒãƒˆ
    forfeitPointInput.value = '300';
    
    // å€ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚’æ›´æ–°
    if (doubleMode) {
      forfeitDoubleAmount.textContent = '600 Pt';
      forfeitDoubleNotice.style.display = 'block';
    } else {
      forfeitDoubleNotice.style.display = 'none';
    }
    
    // å…¥åŠ›å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆå€ãƒ¢ãƒ¼ãƒ‰è¨ˆç®—ç”¨ï¼‰
    forfeitPointInput.oninput = function() {
      const basePoints = parseInt(forfeitPointInput.value) || 0;
      if (doubleMode) {
        forfeitDoubleAmount.textContent = `${(basePoints * 2).toLocaleString()} Pt`;
      }
    };
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ä½ç½®ã‚’ä¸­å¤®ã«
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;
    const modalWidth = forfeitPointModal.offsetWidth || 300;
    const modalHeight = forfeitPointModal.offsetHeight || 200;
    
    forfeitPointModal.style.position = 'fixed';
    forfeitPointModal.style.top = `${(viewportHeight - modalHeight) / 2}px`;
    forfeitPointModal.style.left = `${(viewportWidth - modalWidth) / 2}px`;
    
    // ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    forfeitConfirm.onclick = function() {
      const points = parseInt(forfeitPointInput.value);
      if (isNaN(points) || points <= 0) {
        showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'ãƒã‚¤ãƒ³ãƒˆã¯1ä»¥ä¸Šã®æ•´æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚');
        return;
      }
      
      // å®Ÿéš›ã«æ²¡åã•ã‚Œã‚‹ãƒã‚¤ãƒ³ãƒˆï¼ˆå€ãƒ¢ãƒ¼ãƒ‰è€ƒæ…®ï¼‰
      const actualPoints = doubleMode ? points * 2 : points;
      
      // æ²¡åç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      forfeitModalBody.innerHTML = `<p>${players[fromPlayerId].name}ã‹ã‚‰ ${actualPoints.toLocaleString()} Pt ã‚’æ²¡åã—ã¾ã™ã€‚${doubleMode ? '<br><strong>â€»å€ãƒ¢ãƒ¼ãƒ‰é©ç”¨ä¸­</strong>' : ''}</p>`;
      forfeitModal.style.display = 'flex';
      forfeitPointModal.style.display = 'none';
      
      // ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      confirmForfeitBtn.onclick = function() {
        if (executeForfeit(fromPlayerId, points)) {
          forfeitModal.style.display = 'none';
        }
      };
    };
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    forfeitPointModal.style.display = 'block';
  }
  
  // æŠ½é¸ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function showCard(card) {
    cardTitle.textContent = card.title;
    cardDescription.textContent = card.rule;
    cardModal.style.display = 'flex';
    currentCard = card;
  }
  
  // ã‚«ãƒ¼ãƒ‰ã‚’é©ç”¨ã™ã‚‹é–¢æ•°
  function applyCardRule(card) {
    activeRules.push(card);
    updateActiveRules();
    showToast('success', 'ã‚«ãƒ¼ãƒ‰é©ç”¨', `ã€Œ${card.title}ã€ã‚’é©ç”¨ã—ã¾ã—ãŸã€‚`);
  }
  
  // é©ç”¨ä¸­ã®ãƒ«ãƒ¼ãƒ«ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateActiveRules() {
    if (activeRules.length === 0) {
      rulesList.innerHTML = '';
      noRulesMessage.style.display = 'block';
      return;
    }
    
    noRulesMessage.style.display = 'none';
    rulesList.innerHTML = '';
    
    activeRules.forEach((rule, index) => {
      const li = document.createElement('li');
      li.classList.add('rule-item');
      li.innerHTML = `
        <div class="rule-header">
          <span class="rule-name">${rule.title}</span>
          <button class="rule-action" data-index="${index}">å‰Šé™¤</button>
        </div>
        <div class="rule-description">${rule.rule}</div>
      `;
      rulesList.appendChild(li);
    });
    
    // å‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.querySelectorAll('.rule-action').forEach(btn => {
      btn.addEventListener('click', function() {
        const index = parseInt(this.dataset.index);
        const removedRule = activeRules.splice(index, 1)[0];
        updateActiveRules();
        showToast('warning', 'ãƒ«ãƒ¼ãƒ«å‰Šé™¤', `ã€Œ${removedRule.title}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
      });
    });
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    saveState();
  }
  
  // æ®‹ã‚Šã®ã‚«ãƒ¼ãƒ‰æšæ•°ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateRemainingCards() {
    cardsRemaining.textContent = `${shuffledCards.length}æš`;
  }
  
  // çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹é–¢æ•°
  function saveState() {
    const state = {
      players,
      totalForfeit,
      doubleMode,
      history,
      activeRules,
      shuffledCards
    };
    
    localStorage.setItem('momotetsuDashboardState', JSON.stringify(state));
  }
  
  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
  function loadState() {
    const savedState = localStorage.getItem('momotetsuDashboardState');
    if (!savedState) return;
    
    try {
      const state = JSON.parse(savedState);
      
      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
      Object.keys(state.players).forEach(playerId => {
        players[playerId] = state.players[playerId];
        updatePlayerDisplay(playerId);
      });
      
      // æ²¡åãƒã‚¤ãƒ³ãƒˆåˆè¨ˆã‚’å¾©å…ƒ
      totalForfeit = state.totalForfeit;
      updateTotalForfeit();
      
      // å€ãƒ¢ãƒ¼ãƒ‰ã‚’å¾©å…ƒ
      doubleMode = state.doubleMode;
      doubleModeToggle.checked = doubleMode;
      
      // å±¥æ­´ã‚’å¾©å…ƒ
      history = state.history || [];
      if (history.length > 0) {
        historySection.innerHTML = '';
        history.forEach(item => {
          const historyItem = document.createElement('div');
          historyItem.classList.add('history-item', item.action);
          
          const timeString = new Date(item.timestamp).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
          
          let message = '';
          if (item.action === 'transfer') {
            message = `${timeString} - ${players[item.from].name} â†’ ${players[item.to].name}: ${item.points.toLocaleString()} Pt`;
          } else if (item.action === 'forfeit') {
            message = `${timeString} - ${players[item.from].name} ã‹ã‚‰æ²¡å: ${item.points.toLocaleString()} Pt`;
          }
          
          historyItem.textContent = message;
          historySection.appendChild(historyItem);
        });
      }
      
      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ«ãƒ¼ãƒ«ã‚’å¾©å…ƒ
      activeRules = state.activeRules || [];
      updateActiveRules();
      
      // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚’å¾©å…ƒ
      if (state.shuffledCards && state.shuffledCards.length > 0) {
        shuffledCards = state.shuffledCards;
      }
      updateRemainingCards();
      
      // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ›´æ–°
      updateRankings();
      
    } catch (error) {
      console.error('çŠ¶æ…‹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
    }
  }
  
  // å€ãƒ¢ãƒ¼ãƒ‰ãƒˆã‚°ãƒ«ã®å‡¦ç†
  doubleModeToggle.addEventListener('change', function() {
    doubleMode = this.checked;
    saveState();
    
    if (doubleMode) {
      showToast('warning', 'å€ãƒ¢ãƒ¼ãƒ‰', 'æ²¡åãƒã‚¤ãƒ³ãƒˆãŒ2å€ã«ãªã‚Šã¾ã™ã€‚');
    } else {
      showToast('info', 'é€šå¸¸ãƒ¢ãƒ¼ãƒ‰', 'æ²¡åãƒã‚¤ãƒ³ãƒˆãŒé€šå¸¸ã«æˆ»ã‚Šã¾ã™ã€‚');
    }
  });
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ã®ã€Œç§»å‹•ã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
  document.querySelectorAll('.player-card [data-action="transfer"]').forEach(btn => {
    btn.addEventListener('click', function(e) {
      const playerId = this.closest('.player-card').dataset.player;
      
      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
      showPlayerPopup(playerId, this);
      
      // ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚’åœæ­¢
      e.stopPropagation();
    });
  });
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ã®ã€Œæ²¡åã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
  document.querySelectorAll('.player-card [data-action="forfeit"]').forEach(btn => {
    btn.addEventListener('click', function() {
      const playerId = this.closest('.player-card').dataset.player;
      
      // æ²¡åãƒã‚¤ãƒ³ãƒˆå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      showForfeitPointModal(playerId);
    });
  });
  
  // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
  document.addEventListener('click', function(event) {
    if (
      playerPopup.style.display === 'block' && 
      !playerPopup.contains(event.target) && 
      !event.target.closest('.transfer-btn')
    ) {
      playerPopup.style.display = 'none';
    }
  });
  
  // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
      playerPopup.style.display = 'none';
      transferPointModal.style.display = 'none';
      forfeitPointModal.style.display = 'none';
      
      document.querySelectorAll('.modal-container').forEach(modal => {
        modal.style.display = 'none';
      });
    }
  });
  
  // ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒƒã‚­ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
  cardDeck.addEventListener('click', function() {
    if (shuffledCards.length === 0) {
      showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
      return;
    }
    
    // ã‚«ãƒ¼ãƒ‰ã‚’1æšå¼•ã
    const card = shuffledCards.pop();
    updateRemainingCards();
    showCard(card);
    saveState();
    
    // ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
    this.classList.add('float');
    setTimeout(() => {
      this.classList.remove('float');
    }, 500);
  });
  
  // ã‚«ãƒ¼ãƒ‰ã‚’é©ç”¨ã™ã‚‹ãƒœã‚¿ãƒ³ã®å‡¦ç†
  applyCardBtn.addEventListener('click', function() {
    if (currentCard) {
      applyCardRule(currentCard);
      cardModal.style.display = 'none';
      currentCard = null;
    }
  });
  
  // ã‚«ãƒ¼ãƒ‰ã‚’ç ´æ£„ã™ã‚‹ãƒœã‚¿ãƒ³ã®å‡¦ç†
  discardCardBtn.addEventListener('click', function() {
    if (currentCard) {
      showToast('info', 'ã‚«ãƒ¼ãƒ‰ç ´æ£„', `ã€Œ${currentCard.title}ã€ã‚’ç ´æ£„ã—ã¾ã—ãŸã€‚`);
      cardModal.style.display = 'none';
      currentCard = null;
    }
  });
  
  // åˆæœŸåŒ–
  loadState();
  updateRemainingCards();
});
</script>
</body>
</html>
