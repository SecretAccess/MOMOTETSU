<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¡ƒé‰„GP 2024 ãƒã‚¹ã‚¿ãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
<style>
/* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
:root {
  --primary-color: #e74c3c; /* æ¡ƒé‰„ãƒ†ãƒ¼ãƒã«åˆã‚ã›ãŸèµ¤è‰² */
  --secondary-color: #3498db; /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
  --background-color: #f7f9fc;
  --card-bg: #ffffff;
  --text-color: #333333;
  --border-color: #e0e0e0;
  --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  --button-bg: #f1f1f1;
  --button-active: #d8d8d8;
  --danger-color: #e74c3c;
  --warning-color: #f39c12;
  --success-color: #2ecc71;
  
  /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ©ãƒ¼ */
  --player1-color: #e74c3c;
  --player2-color: #3498db;
  --player3-color: #2ecc71;
  --player4-color: #9b59b6;
  
  /* ã‚«ãƒ¼ãƒ‰ã®è‰² */
  --card-front: #f39c12;
  --card-back: #2ecc71;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
  background-color: var(--background-color);
  color: var(--text-color);
  line-height: 1.6;
  padding-bottom: 60px;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
header {
  background-color: var(--primary-color);
  color: white;
  padding: 1rem;
  text-align: center;
  box-shadow: var(--shadow);
  position: relative;
}

header h1 {
  margin-bottom: 0.5rem;
  font-size: 1.8rem;
}

nav {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  padding: 0.5rem 0;
}

nav a {
  color: white;
  text-decoration: none;
  padding: 5px 10px;
  border-radius: 4px;
  transition: background-color 0.3s;
}

nav a:hover {
  background-color: rgba(255, 255, 255, 0.2);
}

/* ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
.dashboard-container {
  display: grid;
  grid-template-columns: 3fr 1fr;
  gap: 20px;
  max-width: 1600px;
  margin: 0 auto;
  padding: 20px;
}

/* å·¦å´ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¨ãƒªã‚¢ãªã©ï¼‰ */
.main-content {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒªãƒƒãƒ‰ */
.players-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ */
.player-card {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s, box-shadow 0.3s;
  position: relative;
  overflow: hidden;
}

.player-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.player-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.player-card h2 {
  color: white;
  text-align: center;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 1.5rem;
  margin: 0;
}

.player-card:nth-child(1) h2 {
  background-color: var(--player1-color);
}

.player-card:nth-child(2) h2 {
  background-color: var(--player2-color);
}

.player-card:nth-child(3) h2 {
  background-color: var(--player3-color);
}

.player-card:nth-child(4) h2 {
  background-color: var(--player4-color);
}

.player-stats {
  display: flex;
  gap: 10px;
}

.stat-badge {
  background-color: #f8f8f8;
  padding: 5px 8px;
  border-radius: 15px;
  font-size: 0.8rem;
  font-weight: bold;
}

.transfers-count {
  background-color: rgba(52, 152, 219, 0.2);
}

.forfeit-count {
  background-color: rgba(231, 76, 60, 0.2);
}

.player-chips {
  display: flex;
  justify-content: space-around;
  margin: 15px 0;
}

.chip-type {
  text-align: center;
  padding: 10px;
  background-color: #f8f8f8;
  border-radius: 8px;
  width: 30%;
}

.chip-type h3 {
  font-size: 0.9rem;
  margin-bottom: 5px;
  color: #555;
}

.chip-count {
  font-size: 1.3rem;
  font-weight: bold;
}

.black-chip {
  background-color: rgba(52, 73, 94, 0.1);
}

.white-chip {
  background-color: rgba(189, 195, 199, 0.3);
}

.color-chip {
  background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(52, 152, 219, 0.1), rgba(46, 204, 113, 0.1));
}

.player-total {
  text-align: center;
  background: linear-gradient(to right, #f6f6f6, #f0f0f0);
  padding: 10px;
  border-radius: 8px;
  margin: 10px 0;
}

.total-label {
  font-size: 0.9rem;
  color: #777;
}

.total-value {
  font-size: 2rem;
  font-weight: bold;
}

.player-actions {
  display: flex;
  justify-content: space-around;
  margin-top: 15px;
}

.action-btn {
  padding: 8px 12px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 5px;
}

.action-btn:hover {
  transform: translateY(-2px);
}

.transfer-btn {
  background-color: rgba(52, 152, 219, 0.2);
  color: #2980b9;
}

.transfer-btn:hover {
  background-color: rgba(52, 152, 219, 0.3);
}

.forfeit-btn {
  background-color: rgba(231, 76, 60, 0.2);
  color: #c0392b;
}

.forfeit-btn:hover {
  background-color: rgba(231, 76, 60, 0.3);
}

/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ« */
.action-panel {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: var(--shadow);
}

.panel-title {
  color: var(--primary-color);
  margin-bottom: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.panel-title h3 {
  font-size: 1.3rem;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 30px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 22px;
  width: 22px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background-color: var(--primary-color);
}

input:focus + .toggle-slider {
  box-shadow: 0 0 1px var(--primary-color);
}

input:checked + .toggle-slider:before {
  transform: translateX(30px);
}

.toggle-label {
  margin-right: 10px;
  font-size: 0.9rem;
  font-weight: bold;
}

.transfer-form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.form-group {
  display: flex;
  gap: 10px;
  align-items: center;
}

.form-group label {
  min-width: 80px;
  font-weight: bold;
}

.form-control {
  padding: 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  flex-grow: 1;
}

.form-control:focus {
  outline: none;
  border-color: var(--secondary-color);
  box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

/* æ”¹å–„ç‚¹: ãƒãƒ«ãƒãƒãƒƒãƒ—ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ */
.multi-chip-selector {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
}

.chip-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.chip-label {
  display: flex;
  align-items: center;
  gap: 5px;
  width: 120px;
}

.chip-icon {
  width: 15px;
  height: 15px;
  border-radius: 50%;
  display: inline-block;
}

.black-icon {
  background-color: #34495e;
}

.white-icon {
  background-color: #ecf0f1;
  border: 1px solid #bdc3c7;
}

.color-icon {
  background: linear-gradient(135deg, #e74c3c, #3498db, #2ecc71);
}

/* æ”¹å–„ç‚¹: ç›´æ¥å…¥åŠ›ã§ãã‚‹ã‚ˆã†æ”¹å–„ */
.chip-quantity-control {
  display: flex;
  align-items: center;
  gap: 5px;
}

.chip-quantity-control button {
  width: 30px;
  height: 30px;
  display: flex;
  justify-content: center;
  align-items: center;
  border: none;
  background-color: #f0f0f0;
  border-radius: 50%;
  cursor: pointer;
  font-weight: bold;
  font-size: 16px;
}

.chip-quantity-control button:hover {
  background-color: #e0e0e0;
}

.chip-quantity {
  width: 50px;
  text-align: center;
  padding: 5px;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  font-weight: bold;
}

/* ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
.preset-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin-top: 10px;
  margin-bottom: 10px;
}

.preset-btn {
  padding: 8px 10px;
  background-color: #f0f0f0;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: background-color 0.2s;
}

.preset-btn:hover {
  background-color: #e0e0e0;
}

/* ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ— */
.btn-group {
  display: flex;
  justify-content: space-between;
  margin-top: 15px;
}

.submit-btn {
  background-color: var(--secondary-color);
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: background-color 0.2s;
}

.submit-btn:hover {
  background-color: #2980b9;
}

.undo-btn {
  background-color: var(--warning-color);
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: background-color 0.2s;
}

.undo-btn:hover {
  background-color: #d35400;
}

.reset-btn {
  background-color: var(--danger-color);
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: background-color 0.2s;
}

.reset-btn:hover {
  background-color: #c0392b;
}

/* å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.history-section {
  margin-top: 20px;
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid var(--border-color);
  border-radius: 5px;
}

.history-item {
  padding: 8px 12px;
  border-bottom: 1px solid var(--border-color);
  font-size: 0.9rem;
}

.history-item:last-child {
  border-bottom: none;
}

.history-item.transfer {
  background-color: rgba(52, 152, 219, 0.1);
}

.history-item.forfeit {
  background-color: rgba(231, 76, 60, 0.1);
}

.history-item.undo {
  background-color: rgba(243, 156, 18, 0.1);
}

.no-history {
  padding: 20px;
  text-align: center;
  color: #777;
}

/* å³å´ã®ã‚µã‚¤ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.side-content {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

/* ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ */
.summary-card {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: var(--shadow);
}

.summary-title {
  color: var(--primary-color);
  margin-bottom: 15px;
  font-size: 1.2rem;
  text-align: center;
}

.total-forfeit {
  background: linear-gradient(135deg, var(--primary-color) 0%, #c0392b 100%);
  color: white;
  padding: 15px;
  border-radius: 8px;
  text-align: center;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
}

.total-forfeit::before {
  content: "ğŸ’°";
  position: absolute;
  font-size: 5rem;
  opacity: 0.1;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.forfeit-label {
  font-size: 0.9rem;
}

.forfeit-value {
  font-size: 2rem;
  font-weight: bold;
  margin: 5px 0;
}

.rankings {
  list-style: none;
}

.ranking-item {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid #f0f0f0;
}

.ranking-item:last-child {
  border-bottom: none;
}

.player-name {
  display: flex;
  align-items: center;
  gap: 8px;
}

.ranking-value {
  font-weight: bold;
}

/* ã‚«ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
.active-rules {
  margin-bottom: 20px;
  max-height: 300px;
  overflow-y: auto;
}

.rules-list {
  list-style: none;
}

.rule-item {
  background-color: #f8f8f8;
  padding: 15px;
  border-radius: 5px;
  margin-bottom: 10px;
}

.rule-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 5px;
}

.rule-name {
  font-weight: bold;
  color: var(--primary-color);
}

.rule-action {
  color: #777;
  font-size: 0.8rem;
  cursor: pointer;
  background: none;
  border: none;
  padding: 3px 8px;
  border-radius: 3px;
}

.rule-action:hover {
  color: var(--primary-color);
  background-color: rgba(231, 76, 60, 0.1);
}

.rule-description {
  font-size: 0.9rem;
  color: #666;
  line-height: 1.4;
}

.no-rules {
  padding: 15px;
  text-align: center;
  color: #777;
  background-color: #f8f8f8;
  border-radius: 5px;
}

/* ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒƒã‚­ */
.card-deck {
  perspective: 1000px;
  height: 280px;
  position: relative;
  cursor: pointer;
}

.deck-label {
  text-align: center;
  margin-bottom: 10px;
  color: #777;
  font-size: 0.9rem;
}

.card {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.8s;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  border-radius: 10px;
}

.card-front {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--card-front);
  background: linear-gradient(135deg, var(--card-front) 0%, #e67e22 100%);
  color: white;
  font-size: 1.8rem;
  font-weight: bold;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
  overflow: hidden;
}

.card-front:before {
  content: "?";
  font-size: 5rem;
  opacity: 0.2;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.card-front:after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: repeating-linear-gradient(
    45deg,
    rgba(255, 255, 255, 0.1),
    rgba(255, 255, 255, 0.1) 10px,
    rgba(255, 255, 255, 0.2) 10px,
    rgba(255, 255, 255, 0.2) 20px
  );
  border-radius: 10px;
}

.cards-remaining {
  position: absolute;
  bottom: 10px;
  right: 10px;
  background-color: rgba(0, 0, 0, 0.5);
  color: white;
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 0.8rem;
  z-index: 2;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
.modal-container {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal {
  background-color: white;
  border-radius: 10px;
  padding: 20px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  position: relative;
  animation: modalFadeIn 0.3s;
}

@keyframes modalFadeIn {
  from { opacity: 0; transform: translateY(-50px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.modal-title {
  font-size: 1.5rem;
  color: var(--primary-color);
}

.close-modal {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #aaa;
}

.close-modal:hover {
  color: var(--primary-color);
}

.modal-body {
  margin-bottom: 20px;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.modal-btn {
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}

.cancel-btn {
  background-color: #f1f1f1;
  color: #333;
}

.confirm-btn {
  background-color: var(--secondary-color);
  color: white;
}

.danger-btn {
  background-color: var(--danger-color);
  color: white;
}

/* ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« */
.card-reveal {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.revealed-card {
  background: var(--card-back);
  background: linear-gradient(135deg, var(--card-back) 0%, #27ae60 100%);
  color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  width: 100%;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.card-title {
  font-size: 1.5rem;
  margin-bottom: 15px;
  position: relative;
  display: inline-block;
}

.card-title:after {
  content: "";
  display: block;
  width: 60%;
  height: 2px;
  background-color: rgba(255, 255, 255, 0.5);
  position: absolute;
  bottom: -5px;
  left: 20%;
}

.card-description {
  font-size: 1.1rem;
  line-height: 1.5;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

/* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
.toast-container {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 1000;
}

.toast {
  background-color: white;
  color: var(--text-color);
  padding: 12px 20px;
  border-radius: 5px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 300px;
  animation: toastFadeIn 0.3s, toastFadeOut 0.3s 2.7s;
  animation-fill-mode: forwards;
  opacity: 0;
}

@keyframes toastFadeIn {
  from { opacity: 0; transform: translateX(50px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes toastFadeOut {
  from { opacity: 1; transform: translateX(0); }
  to { opacity: 0; transform: translateX(50px); }
}

.toast-icon {
  font-size: 1.5rem;
}

.toast-success {
  border-left: 4px solid #2ecc71;
}

.toast-warning {
  border-left: 4px solid #f39c12;
}

.toast-error {
  border-left: 4px solid #e74c3c;
}

.toast-info {
  border-left: 4px solid #3498db;
}

.toast-content {
  flex-grow: 1;
}

.toast-title {
  font-weight: bold;
  margin-bottom: 3px;
}

.toast-message {
  font-size: 0.9rem;
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
.transfer-popup {
  display: none;
  position: fixed;
  width: 250px;
  background-color: white;
  border-radius: 10px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
  z-index: 100;
  animation: fadeIn 0.2s;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.popup-title {
  padding: 10px 15px;
  background-color: var(--secondary-color);
  color: white;
  border-radius: 10px 10px 0 0;
  font-weight: bold;
}

.popup-content {
  padding: 15px;
}

.player-option {
  padding: 8px 12px;
  margin-bottom: 5px;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.player-option:hover {
  background-color: #f0f0f0;
}

.player-indicator {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
}

.player1-color {
  background-color: var(--player1-color);
}

.player2-color {
  background-color: var(--player2-color);
}

.player3-color {
  background-color: var(--player3-color);
}

.player4-color {
  background-color: var(--player4-color);
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 1200px) {
  .dashboard-container {
    grid-template-columns: 1fr;
  }
  
  .players-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .players-grid {
    grid-template-columns: 1fr;
  }
  
  .player-chips {
    flex-direction: column;
    gap: 10px;
  }
  
  .chip-type {
    width: 100%;
  }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.pulse {
  animation: pulse-animation 0.5s;
}

@keyframes pulse-animation {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.shake {
  animation: shake-animation 0.5s;
}

@keyframes shake-animation {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
  20%, 40%, 60%, 80% { transform: translateX(5px); }
}

.float {
  animation: float-animation 3s infinite ease-in-out;
}

@keyframes float-animation {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}
</style>
</head>
<body>
<header>
  <h1>æ¡ƒé‰„GP ãƒã‚¹ã‚¿ãƒ¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
  <nav>
    <a href="index.html">ãƒãƒƒãƒ—ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</a>
    <a href="rules.html">å¤§ä¼šãƒ«ãƒ¼ãƒ«</a>
    <a href="cards.html">ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰</a>
    <a href="roulette.html">æŠ½é¸ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</a>
    <a href="forfeit-counter.html">æ²¡åãƒã‚¤ãƒ³ãƒˆ</a>
    <a href="hidden-destination.html">è£ç›®çš„åœ°</a>
  </nav>
</header>

<div class="dashboard-container">
  <!-- å·¦å´ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="main-content">
    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚°ãƒªãƒƒãƒ‰ -->
    <div class="players-grid">
      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1 -->
      <div class="player-card" data-player="nozomu">
        <div class="player-header">
          <h2>ã®ãã‚€</h2>
          <div class="player-stats">
            <span class="stat-badge transfers-count" title="ãƒã‚¤ãƒ³ãƒˆç§»å‹•å›æ•°">0</span>
            <span class="stat-badge forfeit-count" title="æ²¡åå›æ•°">0</span>
          </div>
        </div>
        <div class="player-chips">
          <div class="chip-type black-chip">
            <h3>é»’ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="black">3</div>
          </div>
          <div class="chip-type white-chip">
            <h3>ç™½ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="white">6</div>
          </div>
          <div class="chip-type color-chip">
            <h3>ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="color">30</div>
          </div>
        </div>
        <div class="player-total">
          <div class="total-label">ç·è³‡ç”£</div>
          <div class="total-value" data-total>15,000 Pt</div>
        </div>
        <div class="player-actions">
          <button class="action-btn transfer-btn" data-action="transfer">
            <span>ç§»å‹•</span>
          </button>
          <button class="action-btn forfeit-btn" data-action="forfeit">
            <span>æ²¡å</span>
          </button>
        </div>
      </div>
      
      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2 -->
      <div class="player-card" data-player="madoka">
        <div class="player-header">
          <h2>ã¾ã©ã‹</h2>
          <div class="player-stats">
            <span class="stat-badge transfers-count" title="ãƒã‚¤ãƒ³ãƒˆç§»å‹•å›æ•°">0</span>
            <span class="stat-badge forfeit-count" title="æ²¡åå›æ•°">0</span>
          </div>
        </div>
        <div class="player-chips">
          <div class="chip-type black-chip">
            <h3>é»’ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="black">3</div>
          </div>
          <div class="chip-type white-chip">
            <h3>ç™½ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="white">6</div>
          </div>
          <div class="chip-type color-chip">
            <h3>ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="color">30</div>
          </div>
        </div>
        <div class="player-total">
          <div class="total-label">ç·è³‡ç”£</div>
          <div class="total-value" data-total>15,000 Pt</div>
        </div>
        <div class="player-actions">
          <button class="action-btn transfer-btn" data-action="transfer">
            <span>ç§»å‹•</span>
          </button>
          <button class="action-btn forfeit-btn" data-action="forfeit">
            <span>æ²¡å</span>
          </button>
        </div>
      </div>
      
      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼3 -->
      <div class="player-card" data-player="hikaru">
        <div class="player-header">
          <h2>ã²ã‹ã‚‹</h2>
          <div class="player-stats">
            <span class="stat-badge transfers-count" title="ãƒã‚¤ãƒ³ãƒˆç§»å‹•å›æ•°">0</span>
            <span class="stat-badge forfeit-count" title="æ²¡åå›æ•°">0</span>
          </div>
        </div>
        <div class="player-chips">
          <div class="chip-type black-chip">
            <h3>é»’ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="black">3</div>
          </div>
          <div class="chip-type white-chip">
            <h3>ç™½ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="white">6</div>
          </div>
          <div class="chip-type color-chip">
            <h3>ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="color">30</div>
          </div>
        </div>
        <div class="player-total">
          <div class="total-label">ç·è³‡ç”£</div>
          <div class="total-value" data-total>15,000 Pt</div>
        </div>
        <div class="player-actions">
          <button class="action-btn transfer-btn" data-action="transfer">
            <span>ç§»å‹•</span>
          </button>
          <button class="action-btn forfeit-btn" data-action="forfeit">
            <span>æ²¡å</span>
          </button>
        </div>
      </div>
      
      <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼4 -->
      <div class="player-card" data-player="chie">
        <div class="player-header">
          <h2>ã¡ãˆ</h2>
          <div class="player-stats">
            <span class="stat-badge transfers-count" title="ãƒã‚¤ãƒ³ãƒˆç§»å‹•å›æ•°">0</span>
            <span class="stat-badge forfeit-count" title="æ²¡åå›æ•°">0</span>
          </div>
        </div>
        <div class="player-chips">
          <div class="chip-type black-chip">
            <h3>é»’ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="black">3</div>
          </div>
          <div class="chip-type white-chip">
            <h3>ç™½ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="white">6</div>
          </div>
          <div class="chip-type color-chip">
            <h3>ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—</h3>
            <div class="chip-count" data-chip-type="color">30</div>
          </div>
        </div>
        <div class="player-total">
          <div class="total-label">ç·è³‡ç”£</div>
          <div class="total-value" data-total>15,000 Pt</div>
        </div>
        <div class="player-actions">
          <button class="action-btn transfer-btn" data-action="transfer">
            <span>ç§»å‹•</span>
          </button>
          <button class="action-btn forfeit-btn" data-action="forfeit">
            <span>æ²¡å</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ« -->
    <div class="action-panel">
      <div class="panel-title">
        <h3>ãƒã‚¤ãƒ³ãƒˆæ“ä½œ</h3>
        <div style="display: flex; align-items: center;">
          <span class="toggle-label">å€ãƒ¢ãƒ¼ãƒ‰</span>
          <label class="toggle-switch">
            <input type="checkbox" id="double-mode-toggle">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      <div class="transfer-form">
        <div class="form-group">
          <label>æ“ä½œã‚¿ã‚¤ãƒ—</label>
          <select id="action-type" class="form-control">
            <option value="transfer">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ç§»å‹•</option>
            <option value="forfeit">æ²¡å</option>
          </select>
        </div>
        <div class="form-group" id="from-player-group">
          <label>From</label>
          <select id="from-player" class="form-control">
            <option value="nozomu">ã®ãã‚€</option>
            <option value="madoka">ã¾ã©ã‹</option>
            <option value="hikaru">ã²ã‹ã‚‹</option>
            <option value="chie">ã¡ãˆ</option>
          </select>
        </div>
        <div class="form-group" id="to-player-group">
          <label>To</label>
          <select id="to-player" class="form-control">
            <option value="nozomu">ã®ãã‚€</option>
            <option value="madoka">ã¾ã©ã‹</option>
            <option value="hikaru">ã²ã‹ã‚‹</option>
            <option value="chie">ã¡ãˆ</option>
            <option value="forfeit">æ²¡å</option>
          </select>
        </div>
        <div class="form-group">
          <label>ãƒãƒƒãƒ—é¸æŠ</label>
        </div>
        
        <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
        <div class="preset-buttons">
          <button class="preset-btn" data-preset="300">300Pt</button>
          <button class="preset-btn" data-preset="500">500Pt</button>
          <button class="preset-btn" data-preset="1000">1,000Pt</button>
          <button class="preset-btn" data-preset="1500">1,500Pt</button>
          <button class="preset-btn" data-preset="3000">3,000Pt</button>
          <button class="preset-btn" data-preset="5000">5,000Pt</button>
        </div>
        
        <div class="multi-chip-selector">
          <div class="chip-row">
            <div class="chip-label">
              <span class="chip-icon black-icon"></span>
              <span>é»’ãƒãƒƒãƒ— (1000Pt)</span>
            </div>
            <div class="chip-quantity-control">
              <button class="decrease-btn" data-chip-type="black">-</button>
              <input type="number" class="chip-quantity" id="black-quantity" value="0" min="0">
              <button class="increase-btn" data-chip-type="black">+</button>
            </div>
          </div>
          <div class="chip-row">
            <div class="chip-label">
              <span class="chip-icon white-icon"></span>
              <span>ç™½ãƒãƒƒãƒ— (500Pt)</span>
            </div>
            <div class="chip-quantity-control">
              <button class="decrease-btn" data-chip-type="white">-</button>
              <input type="number" class="chip-quantity" id="white-quantity" value="0" min="0">
              <button class="increase-btn" data-chip-type="white">+</button>
            </div>
          </div>
          <div class="chip-row">
            <div class="chip-label">
              <span class="chip-icon color-icon"></span>
              <span>ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ— (300Pt)</span>
            </div>
            <div class="chip-quantity-control">
              <button class="decrease-btn" data-chip-type="color">-</button>
              <input type="number" class="chip-quantity" id="color-quantity" value="0" min="0">
              <button class="increase-btn" data-chip-type="color">+</button>
            </div>
          </div>
          <div class="chip-row" style="margin-top: 10px;">
            <div class="chip-label">åˆè¨ˆãƒã‚¤ãƒ³ãƒˆ:</div>
            <div id="total-points">0 Pt</div>
          </div>
        </div>
        
        <div class="btn-group">
          <button id="undo-btn" class="undo-btn">å–æ¶ˆ</button>
          <button id="submit-action" class="submit-btn">å®Ÿè¡Œ</button>
          <button id="reset-btn" class="reset-btn">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
      </div>
      <div class="history-section">
        <div class="no-history">ã¾ã å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>
      </div>
    </div>
  </div>
  
  <!-- å³å´ã®ã‚µã‚¤ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="side-content">
    <!-- ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ -->
    <div class="summary-card">
      <h3 class="summary-title">çµ±è¨ˆ</h3>
      <div class="total-forfeit">
        <div class="forfeit-label">æ²¡åãƒã‚¤ãƒ³ãƒˆåˆè¨ˆ</div>
        <div class="forfeit-value" id="total-forfeit">0 Pt</div>
      </div>
      <h4 style="margin-bottom: 10px;">å–å¼•ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h4>
      <ul class="rankings" id="transfer-ranking">
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player1-color"></span>
            <span>ã®ãã‚€</span>
          </div>
          <div class="ranking-value">0</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player2-color"></span>
            <span>ã¾ã©ã‹</span>
          </div>
          <div class="ranking-value">0</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player3-color"></span>
            <span>ã²ã‹ã‚‹</span>
          </div>
          <div class="ranking-value">0</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player4-color"></span>
            <span>ã¡ãˆ</span>
          </div>
          <div class="ranking-value">0</div>
        </li>
      </ul>
      
      <h4 style="margin: 15px 0 10px;">æ²¡åãƒ©ãƒ³ã‚­ãƒ³ã‚°</h4>
      <ul class="rankings" id="forfeit-ranking">
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player1-color"></span>
            <span>ã®ãã‚€</span>
          </div>
          <div class="ranking-value">0</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player2-color"></span>
            <span>ã¾ã©ã‹</span>
          </div>
          <div class="ranking-value">0</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player3-color"></span>
            <span>ã²ã‹ã‚‹</span>
          </div>
          <div class="ranking-value">0</div>
        </li>
        <li class="ranking-item">
          <div class="player-name">
            <span class="player-indicator player4-color"></span>
            <span>ã¡ãˆ</span>
          </div>
          <div class="ranking-value">0</div>
        </li>
      </ul>
    </div>
    
    <!-- ã‚«ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
    <div class="summary-card">
      <h3 class="summary-title">é©ç”¨ä¸­ã®ãƒ«ãƒ¼ãƒ«</h3>
      <div class="active-rules">
        <div class="no-rules" id="no-rules-message">ç¾åœ¨é©ç”¨ä¸­ã®ãƒ«ãƒ¼ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“</div>
        <ul class="rules-list" id="rules-list"></ul>
      </div>
      <div class="deck-label">ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã</div>
      <div class="card-deck" id="card-deck">
        <div class="card">
          <div class="card-front"></div>
        </div>
        <div class="cards-remaining" id="cards-remaining">12æš</div>
      </div>
    </div>
  </div>
</div>

<!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
<div class="transfer-popup" id="player-popup">
  <div class="popup-title">ç§»å‹•å…ˆã‚’é¸æŠ</div>
  <div class="popup-content" id="popup-content">
    <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯JSã§å‹•çš„ã«è¿½åŠ  -->
  </div>
</div>

<!-- ç§»å‹•ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-container" id="transfer-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">ãƒã‚¤ãƒ³ãƒˆç§»å‹•ç¢ºèª</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body" id="transfer-modal-body">
      <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã§ãƒãƒƒãƒ—ã‚’ç§»å‹•ã—ã¾ã™ã€‚</p>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="modal-btn confirm-btn" id="confirm-transfer">å®Ÿè¡Œ</button>
    </div>
  </div>
</div>

<!-- æ²¡åç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-container" id="forfeit-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">ãƒã‚¤ãƒ³ãƒˆæ²¡åç¢ºèª</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body" id="forfeit-modal-body">
      <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ãƒãƒƒãƒ—ã‚’æ²¡åã—ã¾ã™ã€‚</p>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="modal-btn confirm-btn" id="confirm-forfeit">å®Ÿè¡Œ</button>
    </div>
  </div>
</div>

<!-- ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-container" id="card-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="card-reveal">
        <div class="revealed-card">
          <div class="card-title" id="card-title">ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«</div>
          <div class="card-description" id="card-description">ã‚«ãƒ¼ãƒ‰ã®åŠ¹æœèª¬æ˜ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel-btn" id="discard-card">ç ´æ£„</button>
      <button class="modal-btn confirm-btn" id="apply-card">é©ç”¨</button>
    </div>
  </div>
</div>

<!-- ãƒªã‚»ãƒƒãƒˆç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-container" id="reset-modal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">å…¨ã¦ãƒªã‚»ãƒƒãƒˆ</h3>
      <button class="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <p>å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</p>
      <p style="color: var(--danger-color); margin-top: 10px; font-weight: bold;">æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ</p>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="modal-btn danger-btn" id="confirm-reset">ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ</button>
    </div>
  </div>
</div>

<!-- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ -->
<div class="toast-container" id="toast-container"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // ãƒãƒƒãƒ—ã®å€¤ã‚’å®šç¾©
  const CHIP_VALUES = {
    black: 1000,
    white: 500,
    color: 300
  };
  
  // åˆæœŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å®šç¾©ï¼ˆãƒªã‚»ãƒƒãƒˆç”¨ã«ä¿æŒï¼‰
  const INITIAL_PLAYER_DATA = {
    nozomu: {
      name: "ã®ãã‚€",
      chips: { black: 3, white: 6, color: 30 },
      total: 15000,
      transferCount: 0,
      forfeitCount: 0
    },
    madoka: {
      name: "ã¾ã©ã‹",
      chips: { black: 3, white: 6, color: 30 },
      total: 15000,
      transferCount: 0,
      forfeitCount: 0
    },
    hikaru: {
      name: "ã²ã‹ã‚‹",
      chips: { black: 3, white: 6, color: 30 },
      total: 15000,
      transferCount: 0,
      forfeitCount: 0
    },
    chie: {
      name: "ã¡ãˆ",
      chips: { black: 3, white: 6, color: 30 },
      total: 15000,
      transferCount: 0,
      forfeitCount: 0
    }
  };
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿
  let players = JSON.parse(JSON.stringify(INITIAL_PLAYER_DATA)); // ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼
  
  // æ²¡åãƒã‚¤ãƒ³ãƒˆåˆè¨ˆ
  let totalForfeit = 0;
  
  // å€ãƒ¢ãƒ¼ãƒ‰ãƒ•ãƒ©ã‚°
  let doubleMode = false;
  
  // ãƒãƒ£ãƒ³ã‚¹ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿
  const cards = [
    { title: "é‹å‘½ã®æ“ä½œ", rule: "æŒ‡å®šã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã®é€²è·¯ã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚" },
    { title: "å¤©ç½", rule: "å…¨å“¡ã‹ã‚‰é»’ãƒãƒƒãƒ—1æšã‚’æ²¡åã€‚" },
    { title: "é˜»å®³è¨ˆç”»", rule: "æ¬¡ã®ç›®çš„åœ°åˆ°é”ãƒœãƒ¼ãƒŠã‚¹ã‚’ç„¡åŠ¹åŒ–ã€‚" },
    { title: "é©å‘½ã®ç¯", rule: "1ä½ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨è‡ªèº«ã®ãƒãƒƒãƒ—ã‚’äº¤æ›ã™ã‚‹ã€‚" },
    { title: "çµŒæ¸ˆæˆé•·æœŸ", rule: "æ¬¡å›ã®ç›®çš„åœ°åˆ°é”ãƒœãƒ¼ãƒŠã‚¹ãŒ2å€ã€‚" },
    { title: "çµŒæ¸ˆä¸æ³", rule: "ä»Šå›ã®ç›®çš„åœ°åˆ°é”ãƒœãƒ¼ãƒŠã‚¹æ²¡åã€‚" },
    { title: "å½å–„ã®å¿ƒ", rule: "å…¨å“¡ãŒç™½ãƒãƒƒãƒ—1æšã‚’ã€æœ€ã‚‚å°‘ãªã„ãƒãƒƒãƒ—ã‚’æŒã¤ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å…¨ã¦è´ˆä¸ã€‚" },
    { title: "å¼·å¥ª", rule: "æŒ‡å®šã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰é»’ãƒãƒƒãƒ—1æšã‚’ç²å¾—ã€‚" },
    { title: "å¤§å¯Œè±ªã®æ©æµ", rule: "å…¨å“¡ã‹ã‚‰é»’ãƒãƒƒãƒ—1æšãšã¤ã‚’ç²å¾—ã€‚" },
    { title: "ç ´ç”£å®£å‘Š", rule: "æŒ‡å®šã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å…¨ã¦ã®é»’ãƒãƒƒãƒ—ã‚’æ²¡åã€‚" },
    { title: "å¾©è®ã®ä¸€æ’ƒ", rule: "æŒ‡å®šã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰é»’ãƒãƒƒãƒ—2æšã‚’ç²å¾—ã€‚" },
    { title: "ç„¡æ•µã®é˜²å¾¡", rule: "ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚«ãƒ¼ãƒ‰åŠ¹æœã‚’å—ã‘ãªããªã‚‹ã€‚" }
  ];
  
  // ã‚«ãƒ¼ãƒ‰ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  let shuffledCards = [...cards].sort(() => Math.random() - 0.5);
  let activeRules = [];
  
  // å±¥æ­´ãƒ‡ãƒ¼ã‚¿
  let history = [];
  
  // çŠ¶æ…‹ã®å±¥æ­´ï¼ˆUndoç”¨ï¼‰
  let stateHistory = [];
  
  // é¸æŠä¸­ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±
  let selectedFromPlayer = null;
  let selectedToPlayer = null;
  
  // é¸æŠä¸­ã®ãƒãƒƒãƒ—æƒ…å ±
  let selectedChips = {
    black: 0,
    white: 0,
    color: 0
  };
  
  // DOMè¦ç´ ã®å‚ç…§ã‚’å–å¾—
  const actionTypeSelect = document.getElementById('action-type');
  const fromPlayerSelect = document.getElementById('from-player');
  const toPlayerSelect = document.getElementById('to-player');
  const blackQuantity = document.getElementById('black-quantity');
  const whiteQuantity = document.getElementById('white-quantity');
  const colorQuantity = document.getElementById('color-quantity');
  const totalPoints = document.getElementById('total-points');
  const submitActionBtn = document.getElementById('submit-action');
  const undoBtn = document.getElementById('undo-btn');
  const resetBtn = document.getElementById('reset-btn');
  const doubleModeToggle = document.getElementById('double-mode-toggle');
  const fromPlayerGroup = document.getElementById('from-player-group');
  const toPlayerGroup = document.getElementById('to-player-group');
  const historySection = document.querySelector('.history-section');
  const transferModal = document.getElementById('transfer-modal');
  const forfeitModal = document.getElementById('forfeit-modal');
  const resetModal = document.getElementById('reset-modal');
  const transferModalBody = document.getElementById('transfer-modal-body');
  const forfeitModalBody = document.getElementById('forfeit-modal-body');
  const confirmTransferBtn = document.getElementById('confirm-transfer');
  const confirmForfeitBtn = document.getElementById('confirm-forfeit');
  const confirmResetBtn = document.getElementById('confirm-reset');
  const totalForfeitDisplay = document.getElementById('total-forfeit');
  const transferRanking = document.getElementById('transfer-ranking');
  const forfeitRanking = document.getElementById('forfeit-ranking');
  const cardDeck = document.getElementById('card-deck');
  const cardsRemaining = document.getElementById('cards-remaining');
  const cardModal = document.getElementById('card-modal');
  const cardTitle = document.getElementById('card-title');
  const cardDescription = document.getElementById('card-description');
  const applyCardBtn = document.getElementById('apply-card');
  const discardCardBtn = document.getElementById('discard-card');
  const rulesList = document.getElementById('rules-list');
  const noRulesMessage = document.getElementById('no-rules-message');
  const toastContainer = document.getElementById('toast-container');
  const playerPopup = document.getElementById('player-popup');
  const popupContent = document.getElementById('popup-content');
  const presetButtons = document.querySelectorAll('.preset-btn');
  
  // ç¾åœ¨é¸æŠä¸­ã®ã‚«ãƒ¼ãƒ‰
  let currentCard = null;
  
  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  document.querySelectorAll('.close-modal, .cancel-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.modal-container').forEach(modal => {
        modal.style.display = 'none';
      });
  
  // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  resetBtn.addEventListener('click', function() {
    resetModal.style.display = 'flex';
  });
  
  // ãƒªã‚»ãƒƒãƒˆç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  confirmResetBtn.addEventListener('click', function() {
    resetAll();
    resetModal.style.display = 'none';
  });
  
  // å–æ¶ˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  undoBtn.addEventListener('click', function() {
    undoLastAction();
  });
    });
  });
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒãƒƒãƒ—æ•°ã¨ç·è³‡ç”£ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updatePlayerDisplay(playerId) {
    const player = players[playerId];
    const playerCard = document.querySelector(`.player-card[data-player="${playerId}"]`);
    
    if (playerCard) {
      // ãƒãƒƒãƒ—æ•°ã‚’æ›´æ–°
      Object.keys(player.chips).forEach(chipType => {
        const chipElement = playerCard.querySelector(`[data-chip-type="${chipType}"]`);
        if (chipElement) {
          chipElement.textContent = player.chips[chipType];
        }
      });
      
      // ç·è³‡ç”£ã‚’æ›´æ–°
      const totalElement = playerCard.querySelector('[data-total]');
      if (totalElement) {
        totalElement.textContent = `${player.total.toLocaleString()} Pt`;
      }
      
      // ç§»å‹•å›æ•°ã¨æ²¡åå›æ•°ã‚’æ›´æ–°
      const transfersCountElement = playerCard.querySelector('.transfers-count');
      const forfeitCountElement = playerCard.querySelector('.forfeit-count');
      
      if (transfersCountElement) {
        transfersCountElement.textContent = player.transferCount;
      }
      
      if (forfeitCountElement) {
        forfeitCountElement.textContent = player.forfeitCount;
      }
    }
  }
  
  // ç·è³‡ç”£ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
  function calculateTotal(player) {
    let total = 0;
    Object.keys(player.chips).forEach(chipType => {
      total += player.chips[chipType] * CHIP_VALUES[chipType];
    });
    return total;
  }
  
  // æ²¡åãƒã‚¤ãƒ³ãƒˆåˆè¨ˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateTotalForfeit() {
    totalForfeitDisplay.textContent = `${totalForfeit.toLocaleString()} Pt`;
  }
  
  // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateRankings() {
    // å–å¼•ãƒ©ãƒ³ã‚­ãƒ³ã‚°
    const transferEntries = Object.entries(players).map(([id, player]) => ({ id, count: player.transferCount }));
    transferEntries.sort((a, b) => b.count - a.count);
    
    const transferItems = transferRanking.querySelectorAll('.ranking-item');
    transferEntries.forEach((entry, index) => {
      const item = transferItems[index];
      if (item) {
        const playerName = item.querySelector('.player-name span:last-child');
        const rankingValue = item.querySelector('.ranking-value');
        
        if (playerName) {
          playerName.textContent = players[entry.id].name;
        }
        
        if (rankingValue) {
          rankingValue.textContent = entry.count;
        }
      }
    });
    
    // æ²¡åãƒ©ãƒ³ã‚­ãƒ³ã‚°
    const forfeitEntries = Object.entries(players).map(([id, player]) => ({ id, count: player.forfeitCount }));
    forfeitEntries.sort((a, b) => b.count - a.count);
    
    const forfeitItems = forfeitRanking.querySelectorAll('.ranking-item');
    forfeitEntries.forEach((entry, index) => {
      const item = forfeitItems[index];
      if (item) {
        const playerName = item.querySelector('.player-name span:last-child');
        const rankingValue = item.querySelector('.ranking-value');
        
        if (playerName) {
          playerName.textContent = players[entry.id].name;
        }
        
        if (rankingValue) {
          rankingValue.textContent = entry.count;
        }
      }
    });
  }
  
  // å±¥æ­´ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
  function addHistory(action, from, to, chips, points) {
    const now = new Date();
    const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
    
    let message = '';
    if (action === 'transfer') {
      // ãƒãƒƒãƒ—ã®å†…è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
      let chipDetails = [];
      Object.keys(chips).forEach(chipType => {
        if (chips[chipType] > 0) {
          const name = getChipTypeName(chipType);
          chipDetails.push(`${name} Ã—${chips[chipType]}`);
        }
      });
      
      message = `${timeString} - ${players[from].name} â†’ ${players[to].name}: ${chipDetails.join(', ')} (${points.toLocaleString()} Pt)`;
    } else if (action === 'forfeit') {
      // ãƒãƒƒãƒ—ã®å†…è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
      let chipDetails = [];
      Object.keys(chips).forEach(chipType => {
        if (chips[chipType] > 0) {
          const name = getChipTypeName(chipType);
          chipDetails.push(`${name} Ã—${chips[chipType]}`);
        }
      });
      
      message = `${timeString} - ${players[from].name} ã‹ã‚‰æ²¡å: ${chipDetails.join(', ')} (${points.toLocaleString()} Pt)`;
    } else if (action === 'undo') {
      message = `${timeString} - å–æ¶ˆ: ${from}`;
    }
    
    const historyItem = document.createElement('div');
    historyItem.classList.add('history-item', action);
    historyItem.textContent = message;
    
    // ã€Œã¾ã å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
    const noHistory = historySection.querySelector('.no-history');
    if (noHistory) {
      noHistory.remove();
    }
    
    // å…ˆé ­ã«è¿½åŠ 
    if (historySection.firstChild) {
      historySection.insertBefore(historyItem, historySection.firstChild);
    } else {
      historySection.appendChild(historyItem);
    }
    
    // å±¥æ­´é…åˆ—ã«è¿½åŠ 
    history.unshift({
      action,
      from,
      to,
      chips,
      points,
      timestamp: now.getTime()
    });
    
    // å±¥æ­´ã®æ•°ã‚’åˆ¶é™ï¼ˆæœ€æ–°20ä»¶ã®ã¿ï¼‰
    if (historySection.children.length > 20) {
      historySection.removeChild(historySection.lastChild);
    }
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    saveState();
  }
  
  // ç¾åœ¨ã®çŠ¶æ…‹ã‚’å±¥æ­´ã«ä¿å­˜ï¼ˆUndoç”¨ï¼‰
  function saveStateToHistory() {
    // ç¾åœ¨ã®çŠ¶æ…‹ã‚’ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼
    const currentState = {
      players: JSON.parse(JSON.stringify(players)),
      totalForfeit: totalForfeit,
      history: [...history],
      activeRules: [...activeRules]
    };
    
    stateHistory.push(currentState);
    
    // å±¥æ­´ãŒé•·ã™ãã‚‹å ´åˆã¯å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
    if (stateHistory.length > 20) {
      stateHistory.shift();
    }
  }
  
  // å‰ã®çŠ¶æ…‹ã«æˆ»ã™ï¼ˆUndoï¼‰
  function undoLastAction() {
    if (stateHistory.length === 0) {
      showToast('warning', 'å–æ¶ˆä¸å¯', 'å–ã‚Šæ¶ˆã›ã‚‹æ“ä½œãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
      return;
    }
    
    // æœ€æ–°ã®çŠ¶æ…‹ã‚’å–å¾—
    const previousState = stateHistory.pop();
    
    // çŠ¶æ…‹ã‚’å¾©å…ƒ
    players = previousState.players;
    totalForfeit = previousState.totalForfeit;
    history = previousState.history;
    activeRules = previousState.activeRules;
    
    // ç”»é¢è¡¨ç¤ºã‚’æ›´æ–°
    Object.keys(players).forEach(playerId => {
      updatePlayerDisplay(playerId);
    });
    
    updateTotalForfeit();
    updateRankings();
    updateActiveRules();
    
    // å±¥æ­´è¡¨ç¤ºã‚’æ›´æ–°
    historySection.innerHTML = '';
    if (history.length === 0) {
      historySection.innerHTML = '<div class="no-history">ã¾ã å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
    } else {
      history.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.classList.add('history-item', item.action);
        
        const timeString = new Date(item.timestamp).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        
        let message = '';
        if (item.action === 'transfer') {
          // ãƒãƒƒãƒ—ã®å†…è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
          let chipDetails = [];
          Object.keys(item.chips).forEach(chipType => {
            if (item.chips[chipType] > 0) {
              const name = getChipTypeName(chipType);
              chipDetails.push(`${name} Ã—${item.chips[chipType]}`);
            }
          });
          
          message = `${timeString} - ${players[item.from].name} â†’ ${players[item.to].name}: ${chipDetails.join(', ')} (${item.points.toLocaleString()} Pt)`;
        } else if (item.action === 'forfeit') {
          // ãƒãƒƒãƒ—ã®å†…è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
          let chipDetails = [];
          Object.keys(item.chips).forEach(chipType => {
            if (item.chips[chipType] > 0) {
              const name = getChipTypeName(chipType);
              chipDetails.push(`${name} Ã—${item.chips[chipType]}`);
            }
          });
          
          message = `${timeString} - ${players[item.from].name} ã‹ã‚‰æ²¡å: ${chipDetails.join(', ')} (${item.points.toLocaleString()} Pt)`;
        } else if (item.action === 'undo') {
          message = `${timeString} - å–æ¶ˆ: ${item.from}`;
        }
        
        historyItem.textContent = message;
        historySection.appendChild(historyItem);
      });
    }
    
    // é€šçŸ¥
    showToast('warning', 'æ“ä½œå–æ¶ˆ', 'æœ€å¾Œã®æ“ä½œã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸã€‚');
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    saveState();
  }
  
  // ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã™ã‚‹
  function resetAll() {
    // ã™ã¹ã¦ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
    players = JSON.parse(JSON.stringify(INITIAL_PLAYER_DATA));
    totalForfeit = 0;
    doubleMode = false;
    history = [];
    stateHistory = [];
    activeRules = [];
    shuffledCards = [...cards].sort(() => Math.random() - 0.5);
    
    // UIæ›´æ–°
    Object.keys(players).forEach(playerId => {
      updatePlayerDisplay(playerId);
    });
    
    updateTotalForfeit();
    updateRankings();
    updateActiveRules();
    updateRemainingCards();
    
    // é¸æŠãƒãƒƒãƒ—ã‚’ãƒªã‚»ãƒƒãƒˆ
    resetChipSelection();
    
    // å±¥æ­´è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
    historySection.innerHTML = '<div class="no-history">ã¾ã å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
    
    // å€ãƒ¢ãƒ¼ãƒ‰ãƒˆã‚°ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
    doubleModeToggle.checked = false;
    
    // é€šçŸ¥
    showToast('info', 'ãƒªã‚»ãƒƒãƒˆå®Œäº†', 'ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã—ãŸã€‚');
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    saveState();
  }
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã®ãƒã‚¤ãƒ³ãƒˆç§»å‹•ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
  function executeTransfer(fromPlayer, toPlayer, chips) {
    // ç¾åœ¨ã®çŠ¶æ…‹ã‚’å±¥æ­´ã«ä¿å­˜
    saveStateToHistory();
    
    // ãƒãƒƒãƒ—ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    const totalChips = Object.values(chips).reduce((sum, count) => sum + count, 0);
    if (totalChips === 0) {
      showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'ãƒãƒƒãƒ—ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
      return false;
    }
    
    // ãƒãƒƒãƒ—ãŒååˆ†ã«ã‚ã‚‹ã‹ç¢ºèª
    for (const chipType in chips) {
      if (players[fromPlayer].chips[chipType] < chips[chipType]) {
        showToast('error', 'ã‚¨ãƒ©ãƒ¼', `${players[fromPlayer].name}ã®${getChipTypeName(chipType)}ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚`);
        return false;
      }
    }
    
    // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
    let totalPoints = 0;
    Object.keys(chips).forEach(chipType => {
      totalPoints += CHIP_VALUES[chipType] * chips[chipType];
    });
    
    // ãƒãƒƒãƒ—ã‚’ç§»å‹•
    Object.keys(chips).forEach(chipType => {
      if (chips[chipType] > 0) {
        players[fromPlayer].chips[chipType] -= chips[chipType];
        players[toPlayer].chips[chipType] += chips[chipType];
      }
    });
    
    // ç·è³‡ç”£ã‚’å†è¨ˆç®—
    players[fromPlayer].total = calculateTotal(players[fromPlayer]);
    players[toPlayer].total = calculateTotal(players[toPlayer]);
    
    // ç§»å‹•å›æ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
    players[fromPlayer].transferCount++;
    players[toPlayer].transferCount++;
    
    // è¡¨ç¤ºã‚’æ›´æ–°
    updatePlayerDisplay(fromPlayer);
    updatePlayerDisplay(toPlayer);
    updateRankings();
    
    // å±¥æ­´ã«è¿½åŠ 
    addHistory('transfer', fromPlayer, toPlayer, chips, totalPoints);
    
    // é€šçŸ¥
    showToast('success', 'ãƒã‚¤ãƒ³ãƒˆç§»å‹•', `${players[fromPlayer].name}ã‹ã‚‰${players[toPlayer].name}ã¸${totalPoints.toLocaleString()} Ptç§»å‹•ã—ã¾ã—ãŸã€‚`);
    
    // ãƒãƒƒãƒ—é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
    resetChipSelection();
    
    return true;
  }
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ã®ãƒã‚¤ãƒ³ãƒˆæ²¡åã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
  function executeForfeit(fromPlayer, chips) {
    // ç¾åœ¨ã®çŠ¶æ…‹ã‚’å±¥æ­´ã«ä¿å­˜
    saveStateToHistory();
    
    // ãƒãƒƒãƒ—ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    const totalChips = Object.values(chips).reduce((sum, count) => sum + count, 0);
    if (totalChips === 0) {
      showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'ãƒãƒƒãƒ—ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
      return false;
    }
    
    // ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
    const adjustedChips = {...chips};
    
    // å€ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ãƒãƒƒãƒ—æ•°ã‚’å€ã«ã™ã‚‹
    if (doubleMode) {
      Object.keys(adjustedChips).forEach(chipType => {
        adjustedChips[chipType] *= 2;
      });
    }
    
    // ãƒãƒƒãƒ—ãŒååˆ†ã«ã‚ã‚‹ã‹ç¢ºèª
    for (const chipType in adjustedChips) {
      if (players[fromPlayer].chips[chipType] < adjustedChips[chipType]) {
        showToast('error', 'ã‚¨ãƒ©ãƒ¼', `${players[fromPlayer].name}ã®${getChipTypeName(chipType)}ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚`);
        return false;
      }
    }
    
    // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
    let totalPoints = 0;
    Object.keys(adjustedChips).forEach(chipType => {
      totalPoints += CHIP_VALUES[chipType] * adjustedChips[chipType];
    });
    
    // ãƒãƒƒãƒ—ã‚’æ²¡å
    Object.keys(adjustedChips).forEach(chipType => {
      if (adjustedChips[chipType] > 0) {
        players[fromPlayer].chips[chipType] -= adjustedChips[chipType];
      }
    });
    
    totalForfeit += totalPoints;
    
    // ç·è³‡ç”£ã‚’å†è¨ˆç®—
    players[fromPlayer].total = calculateTotal(players[fromPlayer]);
    
    // æ²¡åå›æ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
    players[fromPlayer].forfeitCount++;
    
    // è¡¨ç¤ºã‚’æ›´æ–°
    updatePlayerDisplay(fromPlayer);
    updateTotalForfeit();
    updateRankings();
    
    // å±¥æ­´ã«è¿½åŠ 
    addHistory('forfeit', fromPlayer, 'forfeit', adjustedChips, totalPoints);
    
    // é€šçŸ¥
    showToast('warning', 'ãƒã‚¤ãƒ³ãƒˆæ²¡å', `${players[fromPlayer].name}ã‹ã‚‰${totalPoints.toLocaleString()} Ptã‚’æ²¡åã—ã¾ã—ãŸã€‚`);
    
    // ãƒãƒƒãƒ—é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
    resetChipSelection();
    
    return true;
  }
  
  // ãƒãƒƒãƒ—ã‚¿ã‚¤ãƒ—ã®æ—¥æœ¬èªåã‚’å–å¾—ã™ã‚‹é–¢æ•°
  function getChipTypeName(chipType) {
    switch (chipType) {
      case 'black':
        return 'é»’ãƒãƒƒãƒ—';
      case 'white':
        return 'ç™½ãƒãƒƒãƒ—';
      case 'color':
        return 'ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—';
      default:
        return chipType;
    }
  }
  
  // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function showToast(type, title, message) {
    const toast = document.createElement('div');
    toast.classList.add('toast', `toast-${type}`);
    
    let icon = '';
    switch (type) {
      case 'success':
        icon = 'âœ…';
        break;
      case 'warning':
        icon = 'âš ï¸';
        break;
      case 'error':
        icon = 'âŒ';
        break;
      default:
        icon = 'â„¹ï¸';
    }
    
    toast.innerHTML = `
      <div class="toast-icon">${icon}</div>
      <div class="toast-content">
        <div class="toast-title">${title}</div>
        <div class="toast-message">${message}</div>
      </div>
    `;
    
    toastContainer.appendChild(toast);
    
    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
    setTimeout(() => {
      toast.style.opacity = '1';
    }, 10);
    
    // 3ç§’å¾Œã«å‰Šé™¤
    setTimeout(() => {
      toast.style.opacity = '0';
      setTimeout(() => {
        toast.remove();
      }, 300);
    }, 3000);
  }
  
  // é¸æŠã•ã‚ŒãŸãƒãƒƒãƒ—ã®åˆè¨ˆãƒã‚¤ãƒ³ãƒˆã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
  function calculateSelectedPoints() {
    let total = 0;
    Object.keys(selectedChips).forEach(chipType => {
      total += selectedChips[chipType] * CHIP_VALUES[chipType];
    });
    return total;
  }
  
  // ãƒãƒƒãƒ—é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°
  function resetChipSelection() {
    selectedChips = {
      black: 0,
      white: 0,
      color: 0
    };
    
    blackQuantity.value = '0';
    whiteQuantity.value = '0';
    colorQuantity.value = '0';
    totalPoints.textContent = '0 Pt';
  }
  
  // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã§ãƒãƒƒãƒ—ã‚’è¨­å®šã™ã‚‹é–¢æ•°
  function setChipsByTotal(totalValue) {
    resetChipSelection();
    
    // ã¾ãšé»’ãƒãƒƒãƒ—ã‚’æœ€å¤§é™ä½¿ç”¨
    const blackCount = Math.floor(totalValue / CHIP_VALUES.black);
    selectedChips.black = blackCount;
    totalValue -= blackCount * CHIP_VALUES.black;
    
    // æ¬¡ã«ç™½ãƒãƒƒãƒ—ã‚’æœ€å¤§é™ä½¿ç”¨
    const whiteCount = Math.floor(totalValue / CHIP_VALUES.white);
    selectedChips.white = whiteCount;
    totalValue -= whiteCount * CHIP_VALUES.white;
    
    // æ®‹ã‚Šã‚’ã‚«ãƒ©ãƒ¼ãƒãƒƒãƒ—ã§èª¿æ•´
    const colorCount = Math.ceil(totalValue / CHIP_VALUES.color);
    selectedChips.color = colorCount;
    
    // è¡¨ç¤ºæ›´æ–°
    blackQuantity.value = selectedChips.black.toString();
    whiteQuantity.value = selectedChips.white.toString();
    colorQuantity.value = selectedChips.color.toString();
    totalPoints.textContent = `${calculateSelectedPoints().toLocaleString()} Pt`;
  }
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é¸æŠãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function showPlayerPopup(fromPlayerId, buttonElement) {
    const buttonRect = buttonElement.getBoundingClientRect();
    
    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ä½ç½®ã‚’è¨­å®š
    playerPopup.style.top = `${buttonRect.bottom + window.scrollY + 10}px`;
    playerPopup.style.left = `${buttonRect.left + window.scrollX}px`;
    
    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¯ãƒªã‚¢
    popupContent.innerHTML = '';
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ï¼ˆé€ä¿¡å…ƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯é™¤ãï¼‰
    Object.keys(players).forEach(playerId => {
      if (playerId !== fromPlayerId) {
        const option = document.createElement('div');
        option.classList.add('player-option');
        
        let indicatorClass = '';
        if (playerId === 'nozomu') indicatorClass = 'player1-color';
        else if (playerId === 'madoka') indicatorClass = 'player2-color';
        else if (playerId === 'hikaru') indicatorClass = 'player3-color';
        else if (playerId === 'chie') indicatorClass = 'player4-color';
        
        option.innerHTML = `
          <span class="player-indicator ${indicatorClass}"></span>
          <span>${players[playerId].name}</span>
        `;
        
        option.addEventListener('click', function() {
          // é¸æŠã•ã‚ŒãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¨˜éŒ²
          selectedFromPlayer = fromPlayerId;
          selectedToPlayer = playerId;
          
          // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ã‚¶ã‚¤ãƒ³æ›´æ–°
          fromPlayerSelect.value = fromPlayerId;
          toPlayerSelect.value = playerId;
          
          // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’éè¡¨ç¤º
          playerPopup.style.display = 'none';
          
          // ãƒãƒ«ãƒãƒãƒƒãƒ—ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
          document.querySelector('.multi-chip-selector').scrollIntoView({ behavior: 'smooth' });
          
          // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã‚’ç§»å‹•ã«è¨­å®š
          actionTypeSelect.value = 'transfer';
          actionTypeSelect.dispatchEvent(new Event('change'));
        });
        
        popupContent.appendChild(option);
      }
    });
    
    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
    playerPopup.style.display = 'block';
  }
  
  // æŠ½é¸ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
  function showCard(card) {
    cardTitle.textContent = card.title;
    cardDescription.textContent = card.rule;
    cardModal.style.display = 'flex';
    currentCard = card;
  }
  
  // ã‚«ãƒ¼ãƒ‰ã‚’é©ç”¨ã™ã‚‹é–¢æ•°
  function applyCardRule(card) {
    activeRules.push(card);
    updateActiveRules();
    showToast('success', 'ã‚«ãƒ¼ãƒ‰é©ç”¨', `ã€Œ${card.title}ã€ã‚’é©ç”¨ã—ã¾ã—ãŸã€‚`);
  }
  
  // é©ç”¨ä¸­ã®ãƒ«ãƒ¼ãƒ«ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateActiveRules() {
    if (activeRules.length === 0) {
      rulesList.innerHTML = '';
      noRulesMessage.style.display = 'block';
      return;
    }
    
    noRulesMessage.style.display = 'none';
    rulesList.innerHTML = '';
    
    activeRules.forEach((rule, index) => {
      const li = document.createElement('li');
      li.classList.add('rule-item');
      li.innerHTML = `
        <div class="rule-header">
          <span class="rule-name">${rule.title}</span>
          <button class="rule-action" data-index="${index}">å‰Šé™¤</button>
        </div>
        <div class="rule-description">${rule.rule}</div>
      `;
      rulesList.appendChild(li);
    });
    
    // å‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    document.querySelectorAll('.rule-action').forEach(btn => {
      btn.addEventListener('click', function() {
        const index = parseInt(this.dataset.index);
        const removedRule = activeRules.splice(index, 1)[0];
        updateActiveRules();
        showToast('warning', 'ãƒ«ãƒ¼ãƒ«å‰Šé™¤', `ã€Œ${removedRule.title}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
      });
    });
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    saveState();
  }
  
  // æ®‹ã‚Šã®ã‚«ãƒ¼ãƒ‰æšæ•°ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function updateRemainingCards() {
    cardsRemaining.textContent = `${shuffledCards.length}æš`;
  }
  
  // çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹é–¢æ•°
  function saveState() {
    const state = {
      players,
      totalForfeit,
      doubleMode,
      history,
      activeRules,
      shuffledCards
    };
    
    localStorage.setItem('momotetsuDashboardState', JSON.stringify(state));
  }
  
  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
  function loadState() {
    const savedState = localStorage.getItem('momotetsuDashboardState');
    if (!savedState) return;
    
    try {
      const state = JSON.parse(savedState);
      
      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
      Object.keys(state.players).forEach(playerId => {
        players[playerId] = state.players[playerId];
        updatePlayerDisplay(playerId);
      });
      
      // æ²¡åãƒã‚¤ãƒ³ãƒˆåˆè¨ˆã‚’å¾©å…ƒ
      totalForfeit = state.totalForfeit;
      updateTotalForfeit();
      
      // å€ãƒ¢ãƒ¼ãƒ‰ã‚’å¾©å…ƒ
      doubleMode = state.doubleMode;
      doubleModeToggle.checked = doubleMode;
      
      // å±¥æ­´ã‚’å¾©å…ƒ
      history = state.history || [];
      if (history.length > 0) {
        historySection.innerHTML = '';
        history.forEach(item => {
          const historyItem = document.createElement('div');
          historyItem.classList.add('history-item', item.action);
          
          const timeString = new Date(item.timestamp).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
          
          let message = '';
          if (item.action === 'transfer') {
            // ãƒãƒƒãƒ—ã®å†…è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
            let chipDetails = [];
            Object.keys(item.chips).forEach(chipType => {
              if (item.chips[chipType] > 0) {
                const name = getChipTypeName(chipType);
                chipDetails.push(`${name} Ã—${item.chips[chipType]}`);
              }
            });
            
            message = `${timeString} - ${players[item.from].name} â†’ ${players[item.to].name}: ${chipDetails.join(', ')} (${item.points.toLocaleString()} Pt)`;
          } else if (item.action === 'forfeit') {
            // ãƒãƒƒãƒ—ã®å†…è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
            let chipDetails = [];
            Object.keys(item.chips).forEach(chipType => {
              if (item.chips[chipType] > 0) {
                const name = getChipTypeName(chipType);
                chipDetails.push(`${name} Ã—${item.chips[chipType]}`);
              }
            });
            
            message = `${timeString} - ${players[item.from].name} ã‹ã‚‰æ²¡å: ${chipDetails.join(', ')} (${item.points.toLocaleString()} Pt)`;
          } else if (item.action === 'undo') {
            message = `${timeString} - å–æ¶ˆ: ${item.from}`;
          }
          
          historyItem.textContent = message;
          historySection.appendChild(historyItem);
        });
      }
      
      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ«ãƒ¼ãƒ«ã‚’å¾©å…ƒ
      activeRules = state.activeRules || [];
      updateActiveRules();
      
      // ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚’å¾©å…ƒ
      if (state.shuffledCards && state.shuffledCards.length > 0) {
        shuffledCards = state.shuffledCards;
      }
      updateRemainingCards();
      
      // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ›´æ–°
      updateRankings();
      
    } catch (error) {
      console.error('çŠ¶æ…‹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
    }
  }
  
  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã®å¤‰æ›´æ™‚ã®å‡¦ç†
  actionTypeSelect.addEventListener('change', function() {
    const actionType = this.value;
    
    if (actionType === 'transfer') {
      fromPlayerGroup.style.display = 'flex';
      toPlayerGroup.style.display = 'flex';
      toPlayerSelect.querySelector('option[value="forfeit"]').style.display = 'none';
    } else if (actionType === 'forfeit') {
      fromPlayerGroup.style.display = 'flex';
      toPlayerGroup.style.display = 'none';
    }
  });
  
  // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
  presetButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      const preset = parseInt(this.dataset.preset);
      setChipsByTotal(preset);
    });
  });
  
  // ãƒãƒƒãƒ—å¢—æ¸›ãƒœã‚¿ãƒ³ã®å‡¦ç†
  document.querySelectorAll('.increase-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const chipType = this.dataset.chipType;
      const quantityElement = document.getElementById(`${chipType}-quantity`);
      
      selectedChips[chipType]++;
      quantityElement.value = selectedChips[chipType];
      
      // åˆè¨ˆãƒã‚¤ãƒ³ãƒˆã‚’æ›´æ–°
      totalPoints.textContent = `${calculateSelectedPoints().toLocaleString()} Pt`;
    });
  });
  
  document.querySelectorAll('.decrease-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const chipType = this.dataset.chipType;
      const quantityElement = document.getElementById(`${chipType}-quantity`);
      
      if (selectedChips[chipType] > 0) {
        selectedChips[chipType]--;
        quantityElement.value = selectedChips[chipType];
        
        // åˆè¨ˆãƒã‚¤ãƒ³ãƒˆã‚’æ›´æ–°
        totalPoints.textContent = `${calculateSelectedPoints().toLocaleString()} Pt`;
      }
    });
  });
  
  // ãƒãƒƒãƒ—æ•°é‡å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‡¦ç†
  document.querySelectorAll('.chip-quantity').forEach(input => {
    input.addEventListener('input', function() {
      const chipType = this.id.split('-')[0];
      const value = parseInt(this.value) || 0;
      
      // è² ã®å€¤ã¯0ã«
      if (value < 0) {
        this.value = '0';
        selectedChips[chipType] = 0;
      } else {
        selectedChips[chipType] = value;
      }
      
      // åˆè¨ˆãƒã‚¤ãƒ³ãƒˆã‚’æ›´æ–°
      totalPoints.textContent = `${calculateSelectedPoints().toLocaleString()} Pt`;
    });
  });
  
  // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®å‡¦ç†
  submitActionBtn.addEventListener('click', function() {
    const actionType = actionTypeSelect.value;
    const fromPlayer = fromPlayerSelect.value;
    const toPlayer = toPlayerSelect.value;
    
    // ãƒãƒƒãƒ—ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    const totalChips = Object.values(selectedChips).reduce((sum, count) => sum + count, 0);
    if (totalChips === 0) {
      showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'ãƒãƒƒãƒ—ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
      return;
    }
    
    if (actionType === 'transfer') {
      if (fromPlayer === toPlayer) {
        showToast('error', 'ã‚¨ãƒ©ãƒ¼', 'é€ä¿¡å…ƒã¨é€ä¿¡å…ˆãŒåŒã˜ã§ã™ã€‚');
        return;
      }
      
      // ç§»å‹•ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      let chipDetails = [];
      Object.keys(selectedChips).forEach(chipType => {
        if (selectedChips[chipType] > 0) {
          chipDetails.push(`${getChipTypeName(chipType)} ${selectedChips[chipType]}æš`);
        }
      });
      
      const totalPointsValue = calculateSelectedPoints();
      
      transferModalBody.innerHTML = `<p>${players[fromPlayer].name}ã‹ã‚‰ ${players[toPlayer].name} ã¸ ${chipDetails.join('ã€')} (${totalPointsValue.toLocaleString()} Pt) ã‚’ç§»å‹•ã—ã¾ã™ã€‚</p>`;
      transferModal.style.display = 'flex';
      
      // ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆä¸€æ—¦å‰Šé™¤ã—ã¦ã‹ã‚‰å†ç™»éŒ²ï¼‰
      confirmTransferBtn.onclick = null;
      confirmTransferBtn.onclick = function() {
        if (executeTransfer(fromPlayer, toPlayer, {...selectedChips})) {
          transferModal.style.display = 'none';
        }
      };
      
    } else if (actionType === 'forfeit') {
      // æ²¡åç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      let chipDetails = [];
      const displayChips = {...selectedChips};
      
      if (doubleMode) {
        Object.keys(displayChips).forEach(chipType => {
          displayChips[chipType] *= 2;
        });
      }
      
      Object.keys(displayChips).forEach(chipType => {
        if (displayChips[chipType] > 0) {
          chipDetails.push(`${getChipTypeName(chipType)} ${displayChips[chipType]}æš`);
        }
      });
      
      let totalPointsValue = 0;
      Object.keys(displayChips).forEach(chipType => {
        totalPointsValue += CHIP_VALUES[chipType] * displayChips[chipType];
      });
      
      forfeitModalBody.innerHTML = `<p>${players[fromPlayer].name}ã‹ã‚‰ ${chipDetails.join('ã€')} (${totalPointsValue.toLocaleString()} Pt) ã‚’æ²¡åã—ã¾ã™ã€‚${doubleMode ? '<br><strong>â€»å€ãƒ¢ãƒ¼ãƒ‰é©ç”¨ä¸­</strong>' : ''}</p>`;
      forfeitModal.style.display = 'flex';
      
      // ç¢ºèªãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆä¸€æ—¦å‰Šé™¤ã—ã¦ã‹ã‚‰å†ç™»éŒ²ï¼‰
      confirmForfeitBtn.onclick = null;
      confirmForfeitBtn.onclick = function() {
        if (executeForfeit(fromPlayer, {...selectedChips})) {
          forfeitModal.style.display = 'none';
        }
      };
    }
    </script>
</body>
</html>
